

<!DOCTYPE html>
<!--[if IE 8]> <html class="ie8"> <![endif]-->
<!--[if IE 9]> <html class="ie9"> <![endif]-->
<!--[if gt IE 9]><!-->
<html>
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
  
  
  <title>Using Tekton Chains for OpenShift Pipelines supply chain security | Securing OpenShift Pipelines | Red Hat OpenShift Pipelines Branch Build</title>
  <link href="https://assets.openshift.net/content/subdomain.css" rel="stylesheet" type="text/css"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/search.css" rel="stylesheet" media="screen"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/autumn.css" rel="stylesheet"  media="screen"/>
  <link href="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" rel="apple-touch-icon-precomposed" type="image/png"/>
  <link href="https://assets.openshift.net/content/subdomain/favicon32x32.png" rel="shortcut icon" type="text/css"/>
  <link href="https://assets.openshift.net/content/osh-nav-footer.css" rel="stylesheet" type="text/css" media="screen"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/docs.css" rel="stylesheet"  media="screen"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/print.css" rel="stylesheet" type="text/css" media="print"/>
  <!--[if IE]><link rel="shortcut icon" href="https://assets.openshift.net/content/subdomain/favicon.ico"><![endif]-->
  <!-- or, set /favicon.ico for IE10 win -->
  <meta content="OpenShift" name="application-name">
  <meta content="#000000" name="msapplication-TileColor">
  <meta content="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" name="msapplication-TileImage">

  <!-- Adobe DTM -->
  <script src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <!-- End Adobe DTM -->

  <script id="trustarc" src="https://static.redhat.com/libs/redhat/marketing/latest/trustarc/trustarc.js"></script>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined"
        rel="stylesheet">

</head>

<body onload="selectVersion('Branch Build');">
  
<nav id="main">
  <div class="container">
    <div class="row">
      <div class="navbar navbar-default navbar-openshift" role="navigation">
        <div class="navbar-header">
            <a href="#nav-main" class="dropdown-toggle navbar-menu-toggle hidden visible-xs" data-toggle="collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>
          <a class="navbar-brand" href="/"></a>
        </div>
        <div id="nav-main" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li id="products" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
                Products <span class="fa fa-angle-down"></span>
              </a>
              <div class="dropdown-menu">
                <div class="row flex-column flex-md-row">
                  <div class="col-xs-12 col-sm-3">
                    <h3>Overview</h3>
                    <ul class="nav flex-column">
                      <li><a target="_blank" href="https://www.openshift.com/products/features/">Features</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/products/pricing/">Pricing</a></li>
                    </ul>
                  </div>
                  <div class="col-xs-12 col-sm-9">
                    <h3>Featured Products</h3>
                    <ul class="nav">
                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/container-platform/">Red Hat OpenShift Container&nbsp;Platform</a>
                        <p class="d-none d-md-block">Build, deploy and manage your applications across cloud- and on-premise infrastructure</p>
                      </li>
                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/dedicated/">Red Hat OpenShift Dedicated</a>
                        <p class="d-none d-md-block">Single-tenant, high-availability Kubernetes clusters in the public cloud</p>
                      </li>

                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/online/">Red Hat OpenShift Online</a>
                        <p class="d-none d-md-block">The fastest way for developers to build, host and scale applications in the public cloud</p>
                      </li>

                      <li class="nav-item">
                        <a target="_blank" href="https://www.openshift.com/products/">All products <span class="fa fa-angle-right"></span></a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>

            <li id="learn" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Learn <span class="fa fa-angle-down"></span>
              </a>
              <div class="dropdown-menu">
                <div class="row flex-md-nowrap">
                  <div class="col-xs-12 col-sm-6">
                    <h3>Learn</h3>
                    <ul class="nav">
                      <li><a target="_blank" href="https://www.openshift.com/learn/what-is-openshift/">What is OpenShift</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/get-started/">Get started</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/partners/">Partners</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/success-stories/">Customer success stories</a></li>
                      <li><a target="_blank" href="https://blog.openshift.com">Blog</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/resources/">Resources</a></li>
                    </ul>
                  </div>
                  <div class="col-xs-12 col-sm-6">
                    <h3>Technology Topics</h3>
                    <ul class="nav">
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/knative/">Knative</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/security/">Security</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/kubernetes/">Kubernetes</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/service-brokers/">Service Brokers</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Community <span class="fa fa-angle-down"></span>
              </a>
              <ul class="dropdown-menu">
                <li><a target="_blank" href="https://commons.openshift.org">OpenShift Commons</a></li>
                <li><a target="_blank" href="https://www.okd.io">Open Source (OKD)</a></li>
                <li><a target="_blank" href="https://www.openshift.com/community/programs/startups/">Startups</a></li>
                <li><a target="_blank" href="https://www.openshift.com/community/programs/grants/">Grants</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Support <span class="fa fa-angle-down"></span>
              </a>
              <ul class="dropdown-menu">
                <li><a target="_blank" href="https://help.openshift.com">Help Center</a></li>
                <li><a href="https://docs.openshift.com">OpenShift Docs</a></li>
              </ul>
            </li>

            <li><a target="_blank" class="nav-sign-up" href="https://www.openshift.com/trial/">Free Trial</a></li>

            <li><a target="_blank" href="https://console.redhat.com/openshift" class="nav-sign-in">Log In <span class="fa fa-angle-right"></span></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</nav>

  
  <div class="container">
    <button id="hc-open-btn" class="open-btn-sm" onclick="openNav()" aria-label="Open"><span class="fa fa-bars" /></button>
    <ol class="breadcrumb hide-for-print">
      

      

      

      

      

      

      <li class="sitename">
        <a href="/">
          Documentation</a>
      </li>
      <li class="hidden-xs active">
        
          <a href="../about/op-release-notes.html">Red Hat OpenShift Pipelines Branch Build</a>
        
      </li>
      <li class="hidden-xs active">
        <a href="../secure/using-tekton-chains-for-openshift-pipelines-supply-chain-security.html">Securing OpenShift Pipelines</a>
      </li>
      
      
      <li class="hidden-xs active">
        Using Tekton Chains for OpenShift Pipelines supply chain security
      </li>
      
      <span text-align="right" style="float: right !important">
        <a href="https://github.com/openshift/openshift-docs/commits/main/secure/using-tekton-chains-for-openshift-pipelines-supply-chain-security.adoc"><span class="material-icons-outlined" title="Page history">history</span></a>
        
        <a href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12332330&issuetype=1&components=12367614&priority=4&summary=Issue+in+file+secure/using-tekton-chains-for-openshift-pipelines-supply-chain-security.adoc">
          <span class="material-icons-outlined" title="Open an issue">bug_report</span>
        </a>
        <a href="javascript: void(0);" onclick="window.print()"><span class="material-icons-outlined" title="Print page (Save as PDF)">picture_as_pdf</span></a>
        
        
      </span>
      
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas hide-for-print">
        <div class="row-fluid">
          <div id="btn-close">
            <button id="hc-close-btn" onclick="closeNav()" class="close-btn-sm" aria-label="close"><span class="fa fa-times" /></button>
          </div>
          <div id="hc-search">
            <input id="hc-search-input" type="text" aria-label="search">
            <button id="hc-search-btn" aria-label="search"><span class="fa fa-search" /></button>
          </div>
        </div>
        <ul class="nav nav-sidebar">
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup0"><span id="tgSpan0" class="fa fa-angle-right"></span>About OpenShift Pipelines</a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../about/op-release-notes.html">OpenShift Pipelines release notes</a></li>
            <li><a class="" href="../about/about-pipelines.html">About OpenShift Pipelines</a></li>
            <li><a class="" href="../about/understanding-openshift-pipelines.html">Understanding OpenShift Pipelines</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup1"><span id="tgSpan1" class="fa fa-angle-right"></span>Installing and configuring</a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../install_config/installing-pipelines.html">Installing OpenShift Pipelines</a></li>
            <li><a class="" href="../install_config/uninstalling-pipelines.html">Uninstalling OpenShift Pipelines</a></li>
            <li><a class="" href="../install_config/customizing-configurations-in-the-tektonconfig-cr.html">Customizing configurations in the TektonConfig custom resource</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup2"><span id="tgSpan2" class="fa fa-angle-right"></span>Managing resource use</a>
      <ul id="topicGroup2" class="collapse  list-unstyled">
            <li><a class="" href="../resource/reducing-pipelines-resource-consumption.html">Reducing resource consumption of OpenShift Pipelines</a></li>
            <li><a class="" href="../resource/setting-compute-resource-quota-for-openshift-pipelines.html">Setting compute resource quota for OpenShift Pipelines</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup3"><span id="tgSpan3" class="fa fa-angle-right"></span>Creating CI/CD pipelines</a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../create/creating-applications-with-cicd-pipelines.html">Creating CI/CD solutions for applications using OpenShift Pipelines</a></li>
            <li><a class="" href="../create/working-with-pipelines-web-console.html">Working with OpenShift Pipelines in the web console</a></li>
            <li><a class="" href="../create/remote-pipelines-tasks-resolvers.html">Specifying remote pipelines and tasks using resolvers</a></li>
            <li><a class="" href="../create/managing-nonversioned-and-versioned-cluster-tasks.html">Managing non-versioned and versioned cluster tasks</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup4"><span id="tgSpan4" class="fa fa-angle-right"></span>Observability in OpenShift Pipelines</a>
      <ul id="topicGroup4" class="collapse  list-unstyled">
            <li><a class="" href="../records/using-tekton-results-for-openshift-pipelines-observability.html">Using Tekton Results for OpenShift Pipelines observability</a></li>
            <li><a class="" href="../records/viewing-pipeline-logs-using-the-openshift-logging-operator.html">Viewing pipeline logs using the OpenShift Logging Operator</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup5"><span id="tgSpan5" class="fa fa-angle-right"></span>Pipelines as Code</a>
      <ul id="topicGroup5" class="collapse  list-unstyled">
            <li><a class="" href="../pac/about-pipelines-as-code.html">About Pipelines as Code</a></li>
            <li><a class="" href="../pac/install-config-pipelines-as-code.html">Installing and configuring Pipelines as Code</a></li>
            <li><a class="" href="../pac/using-pipelines-as-code-repos.html">Using Pipelines as Code with a Git repository hosting service provider</a></li>
            <li><a class="" href="../pac/using-repository-crd.html">Using the Repository custom resource</a></li>
            <li><a class="" href="../pac/using-pac-resolver.html">Using the Pipelines as Code resolver</a></li>
            <li><a class="" href="../pac/managing-pipeline-runs-pac.html">Managing pipeline runs</a></li>
            <li><a class="" href="../pac/pac-command-reference.html">Pipelines as Code command reference</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup6"><span id="tgSpan6" class="fa fa-angle-down"></span>Securing OpenShift Pipelines</a>
      <ul id="topicGroup6" class="collapse in list-unstyled">
            <li><a class=" active" href="../secure/using-tekton-chains-for-openshift-pipelines-supply-chain-security.html">Using Tekton Chains for OpenShift Pipelines supply chain security</a></li>
            <li><a class="" href="../secure/configuring-security-context-for-pods.html">Configuring the security context for pods</a></li>
            <li><a class="" href="../secure/securing-webhooks-with-event-listeners.html">Securing webhooks with event listeners</a></li>
            <li><a class="" href="../secure/authenticating-pipelines-using-git-secret.html">Authenticating pipelines using git secret</a></li>
            <li><a class="" href="../secure/unprivileged-building-of-container-images-using-buildah.html">Unprivileged building of container images using Buildah</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup7"><span id="tgSpan7" class="fa fa-angle-right"></span>Custom Tekton Hub instance</a>
      <ul id="topicGroup7" class="collapse  list-unstyled">
            <li><a class="" href="../hub/using-tekton-hub-with-openshift-pipelines.html">Using Tekton Hub with OpenShift Pipelines</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup8"><span id="tgSpan8" class="fa fa-angle-right"></span>Pipelines CLI (tkn) reference</a>
      <ul id="topicGroup8" class="collapse  list-unstyled">
            <li><a class="" href="../tkn_cli/installing-tkn.html">Installing tkn</a></li>
            <li><a class="" href="../tkn_cli/op-configuring-tkn.html">Configuring tkn</a></li>
            <li><a class="" href="../tkn_cli/op-tkn-reference.html">Basic tkn commands</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div id="hc-search-modal">
        <div id="hc-modal-content">
          <span id="hc-modal-close">&times;</span>
          <div id="hc-search-results-wrapper">
            <div id="hc-search-results"></div>
            <div id="hc-search-progress-indicator" class="text-center search-progress-indicator"><i class="fa fa-circle-o-notch fa-spin" style="font-size:42px"></i></div>
            <div class="text-center">
              <button id="hc-search-more-btn">Show more results</button>
            </div>
          </div>
        </div>
      </div>
      <div class="print-logo" style="display:none;">
        <img src="https://www.redhat.com/cms/managed-files/Logo-Red_Hat-OpenShift-A-Standard-RGB_0_0.svg" alt="print logo"/>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h1>
            Using Tekton Chains for OpenShift Pipelines supply chain security
          </h1>
        </div>
        
        
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#tc-key-features">Key features</a></li>
<li><a href="#configuring-tekton-chains_using-tekton-chains-for-openshift-pipelines-supply-chain-security">Configuring Tekton Chains</a>
<ul class="sectlevel2">
<li><a href="#supported-parameters-tekton-chains-configuration_using-tekton-chains-for-openshift-pipelines-supply-chain-security">Supported parameters for Tekton Chains configuration</a></li>
</ul>
</li>
<li><a href="#signing-secrets-in-tekton-chains_using-tekton-chains-for-openshift-pipelines-supply-chain-security">Secrets for signing data in Tekton Chains</a>
<ul class="sectlevel2">
<li><a href="#chains-signing-secrets-cosign_using-tekton-chains-for-openshift-pipelines-supply-chain-security">Signing using cosign</a></li>
<li><a href="#chains-signing-secrets-skopeo_using-tekton-chains-for-openshift-pipelines-supply-chain-security">Signing using skopeo</a></li>
<li><a href="#chains-resolving-existing-secret_using-tekton-chains-for-openshift-pipelines-supply-chain-security">Resolving the "secret already exists" error</a></li>
</ul>
</li>
<li><a href="#authenticating-to-an-oci-registry_using-tekton-chains-for-openshift-pipelines-supply-chain-security">Authenticating to an OCI registry</a></li>
<li><a href="#creating-and-verifying-task-run-signatures-without-any-additional-authentication_using-tekton-chains-for-openshift-pipelines-supply-chain-security">Creating and verifying task run signatures without any additional authentication</a>
<ul class="sectlevel2">
<li><a href="#additional-resources">Additional resources</a></li>
</ul>
</li>
<li><a href="#using-tekton-chains-to-sign-and-verify-image-and-provenance_using-tekton-chains-for-openshift-pipelines-supply-chain-security">Using Tekton Chains to sign and verify image and provenance</a></li>
<li><a href="#additional-resources-tekton-chains">Additional resources</a></li>
</ul>
</div>
<div class="paragraph _abstract">
<p>Tekton Chains is a Kubernetes Custom Resource Definition (CRD) controller. You can use it to manage the supply chain security of the tasks and pipelines created using Red Hat OpenShift Pipelines.</p>
</div>
<div class="paragraph">
<p>By default, Tekton Chains observes all task run executions in your OpenShift Container Platform cluster. When the task runs complete, Tekton Chains takes a snapshot of the task runs. It then converts the snapshot to one or more standard payload formats, and finally signs and stores all artifacts.</p>
</div>
<div class="paragraph">
<p>To capture information about task runs, Tekton Chains uses <code>Result</code> objects. When the objects are unavailable, Tekton Chains the URLs and qualified digests of the OCI images.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tc-key-features"><a class="anchor" href="#tc-key-features"></a>Key features</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>You can sign task runs, task run results, and OCI registry images with cryptographic keys that are generated by tools such as <code>cosign</code> and <code>skopeo</code>.</p>
</li>
<li>
<p>You can use attestation formats such as <code>in-toto</code>.</p>
</li>
<li>
<p>You can securely store signatures and signed artifacts using OCI repository as a storage backend.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-tekton-chains_using-tekton-chains-for-openshift-pipelines-supply-chain-security"><a class="anchor" href="#configuring-tekton-chains_using-tekton-chains-for-openshift-pipelines-supply-chain-security"></a>Configuring Tekton Chains</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Red Hat OpenShift Pipelines Operator installs Tekton Chains by default. You can configure Tekton Chains by modifying the <code>TektonConfig</code> custom resource; the Operator automatically applies the changes that you make in this custom resource.</p>
</div>
<div class="paragraph">
<p>To edit the custom resource, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc edit TektonConfig config</code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom resource includes a <code>chain:</code> array. You can add any supported configuration parameters to this array, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">operator.tekton.dev/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">TektonConfig</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">addon</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">chain</span><span class="pi">:</span>
    <span class="s">artifacts.taskrun.format</span><span class="pi">:</span> <span class="s">tekton</span>
  <span class="na">config</span><span class="pi">:</span> <span class="pi">{}</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="supported-parameters-tekton-chains-configuration_using-tekton-chains-for-openshift-pipelines-supply-chain-security"><a class="anchor" href="#supported-parameters-tekton-chains-configuration_using-tekton-chains-for-openshift-pipelines-supply-chain-security"></a>Supported parameters for Tekton Chains configuration</h3>
<div class="paragraph">
<p>Cluster administrators can use various supported parameter keys and values to configure specifications about task runs, OCI images, and storage.</p>
</div>
<div class="sect3">
<h4 id="chains-supported-parameters-task-run_using-tekton-chains-for-openshift-pipelines-supply-chain-security"><a class="anchor" href="#chains-supported-parameters-task-run_using-tekton-chains-for-openshift-pipelines-supply-chain-security"></a>Supported parameters for task run artifacts</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Chains configuration: Supported parameters for task run artifacts</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Supported values</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>artifacts.taskrun.format</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The format for storing task run payloads.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>in-toto</code>, <code>slsa/v1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>in-toto</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>artifacts.taskrun.storage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The storage backend for task run signatures. You can specify multiple backends as a comma-separated list, such as <code>“tekton,oci”</code>. To disable storing task run artifacts, provide an empty string <code>“”</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tekton</code>, <code>oci</code>, <code>gcs</code>, <code>docdb</code>, <code>grafeas</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tekton</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>artifacts.taskrun.signer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The signature backend for signing task run payloads.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x509</code>,<code>kms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x509</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>slsa/v1</code> is an alias of <code>in-toto</code> for backwards compatibility.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="chains-supported-parameters-pipeline-run_using-tekton-chains-for-openshift-pipelines-supply-chain-security"><a class="anchor" href="#chains-supported-parameters-pipeline-run_using-tekton-chains-for-openshift-pipelines-supply-chain-security"></a>Supported parameters for pipeline run artifacts</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Chains configuration: Supported parameters for pipeline run artifacts</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Supported values</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>artifacts.pipelinerun.format</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The format for storing pipeline run payloads.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>in-toto</code>, <code>slsa/v1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>in-toto</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>artifacts.pipelinerun.storage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The storage backend for storing pipeline run signatures. You can specify multiple backends as a comma-separated list, such as <code>“tekton,oci”</code>. To disable storing pipeline run artifacts, provide an empty string <code>“”</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tekton</code>, <code>oci</code>, <code>gcs</code>, <code>docdb</code>, <code>grafeas</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tekton</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>artifacts.pipelinerun.signer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The signature backend for signing pipeline run payloads.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x509</code>, <code>kms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x509</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p><code>slsa/v1</code> is an alias of <code>in-toto</code> for backwards compatibility.</p>
</li>
<li>
<p>For the <code>grafeas</code> storage backend, only Container Analysis is supported. You can not configure the <code>grafeas</code> server address in the current version of Tekton Chains.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="chains-supported-parameters-oci_using-tekton-chains-for-openshift-pipelines-supply-chain-security"><a class="anchor" href="#chains-supported-parameters-oci_using-tekton-chains-for-openshift-pipelines-supply-chain-security"></a>Supported parameters for OCI artifacts</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Chains configuration: Supported parameters for OCI artifacts</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Supported values</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>artifacts.oci.format</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The format for storing OCI payloads.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simplesigning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simplesigning</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>artifacts.oci.storage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The storage backend for storing OCI signatures. You can specify multiple backends as a comma-separated list, such as <code>“oci,tekton”</code>. To disable storing OCI artifacts, provide an empty string <code>“”</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tekton</code>, <code>oci</code>, <code>gcs</code>, <code>docdb</code>, <code>grafeas</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oci</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>artifacts.oci.signer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The signature backend for signing OCI payloads.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x509</code>, <code>kms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x509</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="chains-supported-parameters-kms_using-tekton-chains-for-openshift-pipelines-supply-chain-security"><a class="anchor" href="#chains-supported-parameters-kms_using-tekton-chains-for-openshift-pipelines-supply-chain-security"></a>Supported parameters for KMS signers</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Chains configuration: Supported parameters for KMS signers</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Supported values</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signers.kms.kmsref</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URI reference to a KMS service to use in <code>kms</code> signers.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported schemes: <code>gcpkms://</code>, <code>awskms://</code>, <code>azurekms://</code>, <code>hashivault://</code>. See <a href="https://docs.sigstore.dev/cosign/kms_support">KMS Support</a> in the Sigstore documentation for more details.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="chains-supported-parameters-storage_using-tekton-chains-for-openshift-pipelines-supply-chain-security"><a class="anchor" href="#chains-supported-parameters-storage_using-tekton-chains-for-openshift-pipelines-supply-chain-security"></a>Supported parameters for storage</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Chains configuration: Supported parameters for storage</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Supported values</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>storage.gcs.bucket</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The GCS bucket for storage</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>storage.oci.repository</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The OCI repository for storing OCI signatures and attestation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you configure one of the artifact storage backends to <code>oci</code> and do not define this key, Tekton Chains stores the attestation alongside the stored OCI artifact itself. If you define this key, the attestation is not stored alongside the OCI artifact and is instead stored in the designated location. See the <a href="https://github.com/sigstore/cosign#specifying-registry">cosign documentation</a> for additional information.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>builder.id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The builder ID to set for in-toto attestations</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>https://tekton.dev/chains/v2</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you enable the <code>docdb</code> storage method is for any artifacts, configure docstore storage options. For more information about the go-cloud docstore URI format, see the <a href="https://gocloud.dev/howto/docstore/">docstore package documentation</a>. Red Hat OpenShift Pipelines supports the following docstore services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>firestore</code></p>
</li>
<li>
<p><code>dynamodb</code></p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Chains configuration: Supported parameters for <code>docstore</code> storage</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Supported values</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>storage.docdb.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The go-cloud URI reference to a <code>docstore</code> collection. Used if the <code>docdb</code> storage method is enabled for any artifacts.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firestore://projects/[PROJECT]/databases/(default)/documents/[COLLECTION]?name_field=name</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you enable the <code>grafeas</code> storage method for any artifacts, configure Grafeas storage options. For more information about Grafeas notes and occurrences, see <a href="https://github.com/grafeas/grafeas/blob/master/docs/grafeas_concepts.md">Grafeas concepts</a>.</p>
</div>
<div class="paragraph">
<p>To create occurrences, Red Hat OpenShift Pipelines must first create notes that are used to link occurrences. Red Hat OpenShift Pipelines creates two types of occurrences: <code>ATTESTATION</code> Occurrence and <code>BUILD</code> Occurrence.</p>
</div>
<div class="paragraph">
<p>Red Hat OpenShift Pipelines uses the configurable <code>noteid</code> as the prefix of the note name. It appends the suffix <code>-simplesigning</code> for the <code>ATTESTATION</code> note and the suffix <code>-intoto</code> for the <code>BUILD</code> note. If the <code>noteid</code> field is not configured, Red Hat OpenShift Pipelines uses <code>tekton-&lt;NAMESPACE&gt;</code> as the prefix.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Chains configuration: Supported parameters for Grafeas storage</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Supported values</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>storage.grafeas.projectid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The OpenShift Container Platform project in which the Grafeas server for storing occurrences is located.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>storage.grafeas.noteid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional: the prefix to use for the name of all created notes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string without spaces.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>storage.grafeas.notehint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional: the <a href="https://github.com/grafeas/grafeas/blob/cd23d4dc1bef740d6d6d90d5007db5c9a2431c41/proto/v1/attestation.proto#L49"><code>human_readable_name</code></a> field for the Grafeas <code>ATTESTATION</code> note.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>This attestation note was generated by Tekton Chains</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Optionally, you can enable additional uploads of binary transparency attestations.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Chains configuration: Supported parameters for transparency attestation storage</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Supported values</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>transparency.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable or disable automatic binary transparency uploads.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code>, <code>manual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>transparency.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL for uploading binary transparency attestations, if enabled.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>https://rekor.sigstore.dev</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you set <code>transparency.enabled</code> to <code>manual</code>, only task runs and pipeline runs with the following annotation are uploaded to the transparency log:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="s">chains.tekton.dev/transparency-upload</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you configure the <code>x509</code> signature backend, you can optionally enable keyless signing with Fulcio.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Chains configuration: Supported parameters for <code>x509</code> keyless signing with Fulcio</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Supported values</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signers.x509.fulcio.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable or disable requesting automatic certificates from Fulcio.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signers.x509.fulcio.address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Fulcio address for requesting certificates, if enabled.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>https://v1.fulcio.sigstore.dev</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signers.x509.fulcio.issuer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The expected OIDC issuer.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>https://oauth2.sigstore.dev/auth</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signers.x509.fulcio.provider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The provider from which to request the ID Token.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google</code>, <code>spiffe</code>, <code>github</code>, <code>filesystem</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red Hat OpenShift Pipelines attempts to use every provider</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signers.x509.identity.token.file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the file containing the ID Token.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signers.x509.tuf.mirror.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL for the TUF server. <code>$TUF_URL/root.json</code> must be present.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>https://sigstore-tuf-root.storage.googleapis.com</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you configure the <code>kms</code> signature backend, set the KMS configuration, including OIDC and Spire, as necessary.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Chains configuration: Supported parameters for KMS signing</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Supported values</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signers.kms.auth.address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URI of the KMS server (the value of <code>VAULT_ADDR</code>).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signers.kms.auth.token</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication token for the KMS server (the value of <code>VAULT_TOKEN</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signers.kms.auth.oidc.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path for OIDC authentication (for example, <code>jwt</code> for Vault).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signers.kms.auth.oidc.role</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The role for OIDC authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signers.kms.auth.spire.sock</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URI of the Spire socket for the KMS token (for example, <code>unix:///tmp/spire-agent/public/api.sock</code>).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signers.kms.auth.spire.audience</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The audience for requesting a SVID from Spire.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="signing-secrets-in-tekton-chains_using-tekton-chains-for-openshift-pipelines-supply-chain-security"><a class="anchor" href="#signing-secrets-in-tekton-chains_using-tekton-chains-for-openshift-pipelines-supply-chain-security"></a>Secrets for signing data in Tekton Chains</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Cluster administrators can generate a key pair and use Tekton Chains to sign artifacts using a Kubernetes secret. For Tekton Chains to work, a private key and a password for encrypted keys must exist as part of the <code>signing-secrets</code> secret in the <code>openshift-pipelines</code> namespace.</p>
</div>
<div class="paragraph">
<p>Currently, Tekton Chains supports the <code>x509</code> and <code>cosign</code> signature schemes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use only one of the supported signature schemes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use the <code>x509</code> signing scheme with Tekton Chains, store the <code>x509.pem</code> private key of the <code>ed25519</code> or <code>ecdsa</code> type in the <code>signing-secrets</code> Kubernetes secret.</p>
</div>
<div class="sect2">
<h3 id="chains-signing-secrets-cosign_using-tekton-chains-for-openshift-pipelines-supply-chain-security"><a class="anchor" href="#chains-signing-secrets-cosign_using-tekton-chains-for-openshift-pipelines-supply-chain-security"></a>Signing using cosign</h3>
<div class="paragraph">
<p>You can use the <code>cosign</code> signing scheme with Tekton Chains using the <code>cosign</code> tool.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You installed the <a href="https://docs.sigstore.dev/cosign/installation/">cosign</a> tool.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Generate the <code>cosign.key</code> and <code>cosign.pub</code> key pairs by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>cosign generate-key-pair k8s://openshift-pipelines/signing-secrets</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cosign prompts you for a password and then creates a Kubernetes secret.</p>
</div>
</li>
<li>
<p>Store the encrypted <code>cosign.key</code> private key and the <code>cosign.password</code> decryption password in the <code>signing-secrets</code> Kubernetes secret. Ensure that the private key is stored as an encrypted PEM file of the <code>ENCRYPTED COSIGN PRIVATE KEY</code> type.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="chains-signing-secrets-skopeo_using-tekton-chains-for-openshift-pipelines-supply-chain-security"><a class="anchor" href="#chains-signing-secrets-skopeo_using-tekton-chains-for-openshift-pipelines-supply-chain-security"></a>Signing using skopeo</h3>
<div class="paragraph">
<p>You can generate keys using the <code>skopeo</code> tool and use them in the <code>cosign</code> signing scheme with Tekton Chains.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You installed the <a href="https://github.com/containers/skopeo">skopeo</a> tool.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Generate a public/private key pair by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>skopeo generate-sigstore-key <span class="nt">--output-prefix</span> &lt;mykey&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Replace <code>&lt;mykey&gt;</code> with a key name of your choice.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Skopeo prompts you for a passphrase for the private key and then creates the key files named <code>&lt;mykey&gt;.private</code> and <code>&lt;mykey&gt;.pub</code>.</p>
</div>
</li>
<li>
<p>Encode the <code>&lt;mykey&gt;.pub</code> file using the <code>base64</code> tool by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">base64</span> <span class="nt">-w</span> 0 &lt;mykey&gt;.pub <span class="o">&gt;</span> b64.pub</code></pre>
</div>
</div>
</li>
<li>
<p>Encode the <code>&lt;mykey&gt;.private</code> file using the <code>base64</code> tool by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">base64</span> <span class="nt">-w</span> 0 &lt;mykey&gt;.private <span class="o">&gt;</span> b64.private</code></pre>
</div>
</div>
</li>
<li>
<p>Encode the passhprase using the <code>base64</code> tool by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s1">'&lt;passphrase&gt;'</span> | <span class="nb">base64</span> <span class="nt">-w</span> 0 <span class="o">&gt;</span> b64.passphrase <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Replace <code>&lt;passphrase&gt;</code> with the passphrase that you used for the key pair.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create the <code>signing-secrets</code> secret in the <code>openshift-pipelines</code> namespace by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc create secret generic signing-secrets <span class="nt">-n</span> openshift-pipelines</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>signing-secrets</code> secret by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc edit secret -n openshift-pipelines signing-secrets</pre>
</div>
</div>
<div class="paragraph">
<p>Add the encoded keys in the data of the secret in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="s">cosign.key</span><span class="pi">:</span> <span class="s">&lt;Encoded &lt;mykey&gt;.private&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="s">cosign.password</span><span class="pi">:</span> <span class="s">&lt;Encoded passphrase&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="s">cosign.pub</span><span class="pi">:</span> <span class="s">&lt;Encoded &lt;mykey&gt;.pub&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="na">immutable</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">signing-secrets</span>
<span class="c1"># ...</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">Opaque</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Replace <code>&lt;Encoded &lt;mykey&gt;.private&gt;</code> with the content of the <code>b64.private</code> file.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Replace <code>&lt;Encoded passphrase&gt;</code> with the content of the <code>b64.passphrase</code> file.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Replace <code>&lt;Encoded &lt;mykey&gt;.pub&gt;</code> with the content of the <code>b64.pub</code> file.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="chains-resolving-existing-secret_using-tekton-chains-for-openshift-pipelines-supply-chain-security"><a class="anchor" href="#chains-resolving-existing-secret_using-tekton-chains-for-openshift-pipelines-supply-chain-security"></a>Resolving the "secret already exists" error</h3>
<div class="paragraph">
<p>If the <code>signing-secret</code> secret is already populated, the command to create this secret might output the following error message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">Error from server (AlreadyExists): secrets "signing-secrets" already exists</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can resolve this error by deleting the secret.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Delete the <code>signing-secret</code> secret by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc delete secret signing-secrets <span class="nt">-n</span> openshift-pipelines</code></pre>
</div>
</div>
</li>
<li>
<p>Re-create the key pairs and store them in the secret using your preferred signing scheme.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authenticating-to-an-oci-registry_using-tekton-chains-for-openshift-pipelines-supply-chain-security"><a class="anchor" href="#authenticating-to-an-oci-registry_using-tekton-chains-for-openshift-pipelines-supply-chain-security"></a>Authenticating to an OCI registry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before pushing signatures to an OCI registry, cluster administrators must configure Tekton Chains to authenticate with the registry. The Tekton Chains controller uses the same service account under which the task runs execute. To set up a service account with the necessary credentials for pushing signatures to an OCI registry, perform the following steps:</p>
</div>
<div class="olist discrete">
<div class="title">Procedure</div>
<ol class="discrete">
<li>
<p>Set the namespace and name of the Kubernetes service account.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">NAMESPACE</span><span class="o">=</span>&lt;namespace&gt; <i class="conum" data-value="1"></i><b>(1)</b>
<span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">SERVICE_ACCOUNT_NAME</span><span class="o">=</span>&lt;service_account&gt; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The namespace associated with the service account.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of the service account.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a Kubernetes secret.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc create secret registry-credentials <span class="se">\</span>
  <span class="nt">--from-file</span><span class="o">=</span>.dockerconfigjson <span class="se">\ </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="gp">  --type=kubernetes.io/dockerconfigjson \
  -n $</span>NAMESPACE</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Substitute with the path to your Docker config file. Default path is <code>~/.docker/config.json</code>.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Give the service account access to the secret.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc patch serviceaccount <span class="nv">$SERVICE_ACCOUNT_NAME</span> <span class="se">\</span>
  <span class="nt">-p</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">imagePullSecrets</span><span class="se">\"</span><span class="s2">: [{</span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">registry-credentials</span><span class="se">\"</span><span class="s2">}]}"</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you patch the default <code>pipeline</code> service account that Red Hat OpenShift Pipelines assigns to all task runs, the Red Hat OpenShift Pipelines Operator will override the service account. As a best practice, you can perform the following steps:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a separate service account to assign to user&#8217;s task runs.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc create serviceaccount &lt;service_account_name&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Associate the service account to the task runs by setting the value of the <code>serviceaccountname</code> field in the task run template.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">tekton.dev/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">TaskRun</span>
<span class="na">metadata</span><span class="pi">:</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">build-push-task-run-2</span>
<span class="na">spec</span><span class="pi">:</span>
<span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">build-bot</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="na">taskRef</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">build-push</span>
<span class="nn">...</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Substitute with the name of the newly created service account.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-and-verifying-task-run-signatures-without-any-additional-authentication_using-tekton-chains-for-openshift-pipelines-supply-chain-security"><a class="anchor" href="#creating-and-verifying-task-run-signatures-without-any-additional-authentication_using-tekton-chains-for-openshift-pipelines-supply-chain-security"></a>Creating and verifying task run signatures without any additional authentication</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>To verify signatures of task runs using Tekton Chains with any additional authentication, perform the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an encrypted x509 key pair and save it as a Kubernetes secret.</p>
</li>
<li>
<p>Configure the Tekton Chains backend storage.</p>
</li>
<li>
<p>Create a task run, sign it, and store the signature and the payload as annotations on the task run itself.</p>
</li>
<li>
<p>Retrieve the signature and payload from the signed task run.</p>
</li>
<li>
<p>Verify the signature of the task run.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Ensure that the following components are installed on the cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Red Hat OpenShift Pipelines Operator</p>
</li>
<li>
<p>Tekton Chains</p>
</li>
<li>
<p><a href="https://docs.sigstore.dev/cosign/installation/">Cosign</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an encrypted x509 key pair and save it as a Kubernetes secret. For more information about creating a key pair and saving it as a secret, see "Signing secrets in Tekton Chains".</p>
</li>
<li>
<p>In the Tekton Chains configuration, disable the OCI storage, and set the task run storage and format to <code>tekton</code>. In the <code>TektonConfig</code> custom resource set the following values:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">operator.tekton.dev/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">TektonConfig</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
<span class="na">spec</span><span class="pi">:</span>
<span class="c1"># ...</span>
    <span class="na">chain</span><span class="pi">:</span>
      <span class="s">artifacts.oci.storage</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="s">artifacts.taskrun.format</span><span class="pi">:</span> <span class="s">tekton</span>
      <span class="s">artifacts.taskrun.storage</span><span class="pi">:</span> <span class="s">tekton</span>
<span class="c1"># ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about configuring Tekton Chains using the <code>TektonConfig</code> custom resource, see "Configuring Tekton Chains".</p>
</div>
</li>
<li>
<p>To restart the Tekton Chains controller to ensure that the modified configuration is applied, enter the following command:</p>
<div class="listingblock terminal">
<div class="content">
<pre class="rouge highlight nowrap"><code>$ oc delete po -n openshift-pipelines -l app=tekton-chains-controller</code></pre>
</div>
</div>
</li>
<li>
<p>Create a task run by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc create <span class="nt">-f</span> https://raw.githubusercontent.com/tektoncd/chains/main/examples/taskruns/task-output-image.yaml <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Replace the example URI with the URI or file path pointing to your task run.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">taskrun.tekton.dev/build-push-run-output-image-qbjvh created</span></code></pre>
</div>
</div>
</li>
<li>
<p>Check the status of the steps by entering the following command. Wait until the process finishes.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>tkn <span class="nb">tr </span>describe <span class="nt">--last</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">[...truncated output...]
NAME                            STATUS
∙ create-dir-builtimage-9467f   Completed
∙ git-source-sourcerepo-p2sk8   Completed
∙ build-and-push                Completed
∙ echo                          Completed
∙ image-digest-exporter-xlkn7   Completed</span></code></pre>
</div>
</div>
</li>
<li>
<p>To retrieve the signature from the object stored as <code>base64</code> encoded annotations, enter the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>tkn <span class="nb">tr </span>describe <span class="nt">--last</span> <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.metadata.annotations.chains</span><span class="se">\.</span><span class="s2">tekton</span><span class="se">\.</span><span class="s2">dev/signature-taskrun-</span><span class="nv">$TASKRUN_UID</span><span class="s2">}"</span> | <span class="nb">base64</span> <span class="nt">-d</span> <span class="o">&gt;</span> sig</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">TASKRUN_UID</span><span class="o">=</span><span class="si">$(</span>tkn <span class="nb">tr </span>describe <span class="nt">--last</span> <span class="nt">-o</span>  <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.metadata.uid}'</span><span class="si">)</span></code></pre>
</div>
</div>
</li>
<li>
<p>To verify the signature using the public key that you created, enter the following command:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ cosign verify-blob-attestation --insecure-ignore-tlog --key path/to/cosign.pub --signature sig --type slsaprovenance --check-claims=false /dev/null <i class="conum" data-value="1"></i><b>(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Replace <code>path/to/cosign.pub</code> with the path name of the public key file.
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">Verified OK</span></code></pre>
</div>
</div></td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="additional-resources"><a class="anchor" href="#additional-resources"></a>Additional resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#signing-secrets-in-tekton-chains_using-tekton-chains-for-openshift-pipelines-supply-chain-security">Secrets for signing data in Tekton Chains</a></p>
</li>
<li>
<p><a href="#configuring-tekton-chains_using-tekton-chains-for-openshift-pipelines-supply-chain-security">Configuring Tekton Chains</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-tekton-chains-to-sign-and-verify-image-and-provenance_using-tekton-chains-for-openshift-pipelines-supply-chain-security"><a class="anchor" href="#using-tekton-chains-to-sign-and-verify-image-and-provenance_using-tekton-chains-for-openshift-pipelines-supply-chain-security"></a>Using Tekton Chains to sign and verify image and provenance</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Cluster administrators can use Tekton Chains to sign and verify images and provenances, by performing the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an encrypted x509 key pair and save it as a Kubernetes secret.</p>
</li>
<li>
<p>Set up authentication for the OCI registry to store images, image signatures, and signed image attestations.</p>
</li>
<li>
<p>Configure Tekton Chains to generate and sign provenance.</p>
</li>
<li>
<p>Create an image with Kaniko in a task run.</p>
</li>
<li>
<p>Verify the signed image and the signed provenance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Ensure that the following are installed on the cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Red Hat OpenShift Pipelines Operator</p>
</li>
<li>
<p>Tekton Chains</p>
</li>
<li>
<p><a href="https://docs.sigstore.dev/cosign/installation/">Cosign</a></p>
</li>
<li>
<p><a href="https://docs.sigstore.dev/rekor/installation/">Rekor</a></p>
</li>
<li>
<p><a href="https://stedolan.github.io/jq/">jq</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an encrypted x509 key pair and save it as a Kubernetes secret:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>cosign generate-key-pair k8s://openshift-pipelines/signing-secrets</code></pre>
</div>
</div>
<div class="paragraph">
<p>Provide a password when prompted. Cosign stores the resulting private key as part of the <code>signing-secrets</code> Kubernetes secret in the <code>openshift-pipelines</code> namespace, and writes the public key to the <code>cosign.pub</code> local file.</p>
</div>
</li>
<li>
<p>Configure authentication for the image registry.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To configure the Tekton Chains controller for pushing signature to an OCI registry, use the credentials associated with the service account of the task run. For detailed information, see the "Authenticating to an OCI registry" section.</p>
</li>
<li>
<p>To configure authentication for a Kaniko task that builds and pushes image to the registry, create a Kubernetes secret of the docker <code>config.json</code> file containing the required credentials.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc create secret generic &lt;docker_config_secret_name&gt; <span class="se">\ </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="gp">  --from-file &lt;path_to_config.json&gt;</span><span class="w"> <i class="conum" data-value="2"></i><b>(2)</b>
</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Substitute with the name of the docker config secret.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Substitute with the path to docker <code>config.json</code> file.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure Tekton Chains by setting the <code>artifacts.taskrun.format</code>, <code>artifacts.taskrun.storage</code>, and <code>transparency.enabled</code> parameters in the <code>chains-config</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc patch configmap chains-config <span class="nt">-n</span> openshift-pipelines <span class="nt">-p</span><span class="o">=</span><span class="s1">'{"data":{"artifacts.taskrun.format": "in-toto"}}'</span>
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>oc patch configmap chains-config <span class="nt">-n</span> openshift-pipelines <span class="nt">-p</span><span class="o">=</span><span class="s1">'{"data":{"artifacts.taskrun.storage": "oci"}}'</span>
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>oc patch configmap chains-config <span class="nt">-n</span> openshift-pipelines <span class="nt">-p</span><span class="o">=</span><span class="s1">'{"data":{"transparency.enabled": "true"}}'</span></code></pre>
</div>
</div>
</li>
<li>
<p>Start the Kaniko task.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Apply the Kaniko task to the cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc apply <span class="nt">-f</span> examples/kaniko/kaniko.yaml <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Substitute with the URI or file path to your Kaniko task.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set the appropriate environment variables.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">REGISTRY</span><span class="o">=</span>&lt;url_of_registry&gt; <i class="conum" data-value="1"></i><b>(1)</b>
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">DOCKERCONFIG_SECRET_NAME</span><span class="o">=</span>&lt;name_of_the_secret_in_docker_config_json&gt; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Substitute with the URL of the registry where you want to push the image.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Substitute with the name of the secret in the docker <code>config.json</code> file.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Start the Kaniko task.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>tkn task start <span class="nt">--param</span> <span class="nv">IMAGE</span><span class="o">=</span><span class="nv">$REGISTRY</span>/kaniko-chains <span class="nt">--use-param-defaults</span> <span class="nt">--workspace</span> <span class="nv">name</span><span class="o">=</span><span class="nb">source</span>,emptyDir<span class="o">=</span><span class="s2">""</span> <span class="nt">--workspace</span> <span class="nv">name</span><span class="o">=</span>dockerconfig,secret<span class="o">=</span><span class="nv">$DOCKERCONFIG_SECRET_NAME</span> kaniko-chains</code></pre>
</div>
</div>
<div class="paragraph">
<p>Observe the logs of this task until all steps are complete. On successful authentication, the final image will be pushed to <code>$REGISTRY/kaniko-chains</code>.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Wait for a minute to allow Tekton Chains to generate the provenance and sign it, and then check the availability of the <code>chains.tekton.dev/signed=true</code> annotation on the task run.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get <span class="nb">tr</span> &lt;task_run_name&gt; <span class="se">\ </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="go">-o json | jq -r .metadata.annotations

{
  "chains.tekton.dev/signed": "true",
</span><span class="c">  ...
</span><span class="go">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Substitute with the name of the task run.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Verify the image and the attestation.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>cosign verify <span class="nt">--key</span> cosign.pub <span class="nv">$REGISTRY</span>/kaniko-chains
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>cosign verify-attestation <span class="nt">--key</span> cosign.pub <span class="nv">$REGISTRY</span>/kaniko-chains</code></pre>
</div>
</div>
</li>
<li>
<p>Find the provenance for the image in Rekor.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Get the digest of the $REGISTRY/kaniko-chains image. You can search for it ing the task run, or pull the image to extract the digest.</p>
</li>
<li>
<p>Search Rekor to find all entries that match the <code>sha256</code> digest of the image.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>rekor-cli search <span class="nt">--sha</span> &lt;image_digest&gt; <i class="conum" data-value="1"></i><b>(1)</b>
<span class="go">
</span><span class="gp">&lt;uuid_1&gt;</span><span class="w"> <i class="conum" data-value="2"></i><b>(2)</b>
</span><span class="gp">&lt;uuid_2&gt;</span><span class="w"> <i class="conum" data-value="3"></i><b>(3)</b>
</span><span class="c">...</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Substitute with the <code>sha256</code> digest of the image.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The first matching universally unique identifier (UUID).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The second matching UUID.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The search result displays UUIDs of the matching entries. One of those UUIDs holds the attestation.</p>
</div>
</li>
<li>
<p>Check the attestation.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>rekor-cli get <span class="nt">--uuid</span> &lt;uuid&gt; <span class="nt">--format</span> json | jq <span class="nt">-r</span> .Attestation | <span class="nb">base64</span> <span class="nt">--decode</span> | jq</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1 _additional-resources">
<h2 id="additional-resources-tekton-chains"><a class="anchor" href="#additional-resources-tekton-chains"></a>Additional resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="../install_config/installing-pipelines.html#installing-pipelines">Installing OpenShift Pipelines</a></p>
</li>
</ul>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <script src="https://assets.openshift.net/content/modernizr.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/subdomain.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/nav-tertiary.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/reformat-html.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/hc-search.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/page-loader.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/clipboard.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/collapsible.js" type="text/javascript"></script>
  <script>
  var dk = 'openshift-pipelines';
  var version = 'Branch Build';

  var distros = {
    'openshift-origin': ['docs_origin', version],
    // specific labels are used for OSD instead of the URL filter, due to its unusual URL structure; assume v4
    'openshift-dedicated': ['docs_dedicated_v4'],
    'openshift-online': ['docs_online', version],
    'openshift-enterprise': ['docs_cp', version],
    'openshift-aro' : ['docs_aro', version],
    'openshift-rosa' : ['docs_rosa'],
    'openshift-acs' : ['docs_acs', version],
    'openshift-serverless' : ['docs_serverless', version]
  };

  // only OSD v3 docs have the version variable specified
  if (dk == "openshift-dedicated" && version == "3") {
    distros['openshift-dedicated'] = ['docs_dedicated_v3']
  }

  distros[dk] ? hcSearchCategory.apply(null, distros[dk]) : hcSearchCategory("docs");
  </script>
  <script type="text/javascript">
  /*<![CDATA[*/
  $(document).ready(function() {
    $("[id^='topicGroup']").on('show.bs.collapse', function(event) {
      if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
        $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
      }
    });
    $("[id^='topicGroup']").on('hide.bs.collapse', function(event) {
      if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
        $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
      }
    });
    $("[id^='topicSubGroup']").on('show.bs.collapse', function() {
      $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubGroup']").on('hide.bs.collapse', function() {
      $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubSubGroup']").on('show.bs.collapse', function() {
      $(this).parent().find("[id^='ssgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubSubGroup']").on('hide.bs.collapse', function() {
      $(this).parent().find("[id^='ssgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });

    const collapsibleContent = document.getElementsByTagName("details");
    for (var i = 0; i < collapsibleContent.length; i++) {
      collapsibleContent[i].setAttribute("open", "");
    }

  });
  /*]]>*/
  </script>

  <footer id="rh">

    <div class="container">
        <div class="row">

            <div class="col-sm-2">
                <img src="https://assets.openshift.com/hubfs/images/logos/Logo-RedHat-A-Reverse-RGB.svg" class="img-fluid" alt="Red Hat" style="height: 30px;">
            </div>

            <div class="col-sm-3">
              <p class="text-nowrap">Copyright © 2023 Red Hat, Inc.</p>
            </div>



            <div class="col">
                <nav class="nav">
                    <a target="_blank" href="https://www.redhat.com/en/about/privacy-policy" class="nav-link">Privacy statement</a>
                    <a target="_blank" href="https://www.openshift.com/legal/terms/" class="nav-link">Terms of use</a>
                    <a target="_blank" href="https://www.redhat.com/en/about/all-policies-guidelines" class="nav-link">All policies and guidelines</a>
                    <a id="teconsent"></a>
                </nav>
            </div>
        </div>
    </div>
</footer>
<div id="consent_blackbar" style="z-index: 100; position: fixed"></div>



<!-- Adobe DTM -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
   _satellite.pageBottom();
}
</script>
<!-- End Adobe DTM -->

  <!-- adjust page css based on breadcrumb and/or resize -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      if ($(window).width() >= 1008) {
        adjustSide();
        adjustToc();
        adjustMain();
      }
    });

    window.addEventListener('resize', () => {
      if ($(window).width() >= 1008) {
        adjustSide();
        adjustToc();
        adjustMain();
      } else if ($(window).width() < 1008) {
        sidebar.classList.remove('wide');
        document.querySelector('#hc-search').classList.remove('wide');
        if (sidebar.classList.contains('open')) {
          sidebar.style.display = 'block';
        } else {
          sidebar.style.display = 'none';
        }
        document.querySelector('.main').style.paddingTop = '0px';
      }
    });

    function adjustSide() {
      sidebar.classList.add('wide');
      document.querySelector('#hc-search').classList.add('wide');
      sidebar.style.display = 'block';
      document.querySelector('.sidebar').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 125), 10) + "px";
      document.querySelector('#hc-search').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 95), 10) + "px";
    }

    function adjustToc() {
      if (document.querySelector('#toc') !== null) {
        document.querySelector('#toc').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 90), 10) + "px";
      }
    }

    function adjustMain() {
      document.querySelector('html').style.scrollPaddingTop = parseInt((document.querySelector('.breadcrumb').offsetHeight + 90), 10) + "px";
      document.querySelector('.main').style.paddingTop = parseInt((document.querySelector('.breadcrumb').offsetHeight - 70), 10) + "px";
    }

  </script>

  <!-- remove toc active class when page is loaded -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      var tocItems = $("#toc a");

      for (let i = 0; i < tocItems.length; i++) {
        tocItems[i].classList.remove("toc-active");
      }
    })
  </script>

  <!-- maintain sidebar scroll position between page loads -->
  <script type="text/javascript">
    let sidebar = document.querySelector(".sidebar");
    let scrolltop = localStorage.getItem("sidebar-scroll");

    if (scrolltop == null) {
      sidebar.scrollTop = parseInt(top, 10);
    }

    window.addEventListener("beforeunload", () => {
      localStorage.setItem("sidebar-scroll", sidebar.scrollTop);
    });

    window.addEventListener('load', () => {
      sidebar.scrollTo(0, scrolltop)
    })
  </script>

  <!-- open/close the nav -->
  <script type="text/javascript">
    function closeNav() {
      let sidebar = document.querySelector(".sidebar");
      sidebar.style.display = "none";
      sidebar.classList.remove('open');
    }

    function openNav() {
      let sidebar = document.querySelector(".sidebar");
      let hc_search = document.querySelector('#hc-search');
      sidebar.style.display = "block";
      sidebar.style.top = "0px";
      hc_search.style.top = 'unset';
      sidebar.classList.add('open');
    }
  </script>

  <!-- clear and add toc-active to clicked toc link -->
  <script type="text/javascript">
  $("#toc a").click(function() {
    var tocItems = $("#toc a");
    for (let i = 0; i < tocItems.length; i++) {
      tocItems[i].classList.remove("toc-active");
    }
    this.classList.add("toc-active");
  });
  </script>

  <!-- update active toc class when mouse scrolls -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      window.addEventListener("wheel", () => {

        const ioConfiguration = {
          "rootMargin": "-120px 0px -400px 0px",
          "threshold": 0
        };

        const observer = new IntersectionObserver(setCurrent, ioConfiguration, entries => {
          entries.forEach(entry => {
            var id = entry.target.getAttribute('id');
            //fight with js
            document.querySelector(`#toc li a[href="#${id}"]`).classList.remove('toc-active');
          });
        });

        //track all h1-4 headings that have an id
        document.querySelectorAll('.main h2[id], .main h3[id]').forEach((h) => {
          observer.observe(h);
        });

        //runs when the IntersectionObserver fires
        function setCurrent(e) {
          var allTocLinks = document.querySelectorAll("#toc li a");
          if (allTocLinks !== undefined) {
            e.map(i => {
              if (i.isIntersecting && i.intersectionRatio >= 1) {
                allTocLinks.forEach(link => link.classList.remove("toc-active"));
                document.querySelector(`#toc li a[href="#${i.target.id}"]`).classList.add('toc-active')
              }
            })
          }
        };

        //make clicked toc item active and stop IntersectionObserver
        $("#toc a").click(function() {
          //stop tracking all h1-4 headings that have an id
          document.querySelectorAll('.main h2[id], .main h3[id]').forEach((h) => {
            observer.unobserve(h);
          });
          var tocItems = $("#toc a");
          if (tocItems !== undefined) {
            for (let i = 0; i < tocItems.length; i++) {
              tocItems[i].classList.remove("toc-active");
            };
            this.classList.add("toc-active");
          }
        })
      })
    })
  </script>

  <!--handle page scroll top and bottom, add toc-active -->
  <script type="text/javascript">
    document.addEventListener('scroll', () => {
      //scroll to bottom
      if(document.documentElement.scrollHeight === window.pageYOffset + window.innerHeight) {
        var tocItems = $("#toc a");
        for (let i = 0; i < tocItems.length; i++) {
          tocItems[i].classList.remove("toc-active")
          };
          tocItems[tocItems.length - 1].classList.add("toc-active");
        };
      //scroll to top
      if(window.pageYOffset === 0) {
        var tocItems = $("#toc a");
        for (let i = 0; i < tocItems.length; i++) {
          tocItems[i].classList.remove("toc-active");
          };
          tocItems[0].classList.add("toc-active");
        };
      })
  </script>

  <!--adjust sidebar and toc when footer is displayed -->
  <script type="text/javascript">
    sidebar = document.querySelector('.sidebar')
    toc = document.querySelector('#toc')
    main = document.querySelector('.main')
    okd_footer = document.querySelector('.footer-origin-docs')

    //handle short pages
    if (window.innerHeight === document.documentElement.scrollHeight) {
      //sidebar
      if (sidebar !== null && okd_footer == null) {
        sidebar.style.marginBottom = "38px";
        main.style.marginBottom = "35px";
      };
      //okd sidebar
      if(sidebar !== null && okd_footer !== null) {
        sidebar.style.marginBottom = "176px";
        main.style.marginBottom = "135px";
      }
    };

    //handle scrolling pages
    document.addEventListener('scroll', () => {
      //scroll to bottom
      if ($(window).width() >= 1008) {
        if(sidebar !== null) {
          //pages with multiple toc entries
          if(document.documentElement.scrollHeight === window.pageYOffset + window.innerHeight) {
              //sidebar
              if (sidebar !== null && okd_footer == null){
                sidebar.style.marginBottom = "38px";
                main.style.marginBottom = "35px";
              };
              //toc
              if (toc !== null && okd_footer == null){
                toc.style.bottom = "35px";
              };
              //okd sidebar
              if(sidebar !== null && okd_footer !== null) {
                sidebar.style.marginBottom = "176px";
                main.style.marginBottom = "135px";
              };
              //okd toc
              if (toc !== null && okd_footer !== null){
                toc.style.bottom = "175px";
              };
            };
          if(document.documentElement.scrollHeight != window.pageYOffset + window.innerHeight) {
            sidebar.style.marginBottom = "0px";
            if (toc !== null) {
              toc.style.bottom = "0px";
            }
          }
        }
      }
    })
  </script>

  <!-- adjust alerts on mobile -->
  <script type="text/javascript">
    alert = document.querySelector('#support-alert')
    window.addEventListener("wheel", () => {
      if ($(window).width() < 1008) {
        //adjust alert
        if(window.pageYOffset > 0) {
          if(alert !== null) {
            document.querySelector('#support-alert').style.position = "fixed";
            document.querySelector('#support-alert').style.bottom = "0px";
            document.querySelector('#support-alert').style.margin = "5px";
            document.querySelector('#support-alert').style.zIndex = "9999999";
          }
        }
      }
   });
    window.addEventListener('resize', () => {
      if ($(window).width() >= 1008) {
        if(alert !== null) {
          document.querySelector('#support-alert').style.removeProperty('position');
          document.querySelector('#support-alert').style.removeProperty('bottom');
          document.querySelector('#support-alert').style.removeProperty('margin');
          document.querySelector('#support-alert').style.removeProperty('zIndex');
        }
      }
    })
  </script>

</body>
</html>
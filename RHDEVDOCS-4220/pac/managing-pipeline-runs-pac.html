

<!DOCTYPE html>
<!--[if IE 8]> <html class="ie8"> <![endif]-->
<!--[if IE 9]> <html class="ie9"> <![endif]-->
<!--[if gt IE 9]><!-->
<html>
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
  
  
  <title>Managing pipeline runs | Pipelines as Code | Red Hat OpenShift Pipelines Branch Build</title>
  <link href="https://assets.openshift.net/content/subdomain.css" rel="stylesheet" type="text/css"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/search.css" rel="stylesheet" media="screen"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/autumn.css" rel="stylesheet"  media="screen"/>
  <link href="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" rel="apple-touch-icon-precomposed" type="image/png"/>
  <link href="https://assets.openshift.net/content/subdomain/favicon32x32.png" rel="shortcut icon" type="text/css"/>
  <link href="https://assets.openshift.net/content/osh-nav-footer.css" rel="stylesheet" type="text/css" media="screen"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/docs.css" rel="stylesheet"  media="screen"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/print.css" rel="stylesheet" type="text/css" media="print"/>
  <!--[if IE]><link rel="shortcut icon" href="https://assets.openshift.net/content/subdomain/favicon.ico"><![endif]-->
  <!-- or, set /favicon.ico for IE10 win -->
  <meta content="OpenShift" name="application-name">
  <meta content="#000000" name="msapplication-TileColor">
  <meta content="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" name="msapplication-TileImage">

  <!-- Adobe DTM -->
  <script src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <!-- End Adobe DTM -->

  <script id="trustarc" src="https://static.redhat.com/libs/redhat/marketing/latest/trustarc/trustarc.js"></script>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined"
        rel="stylesheet">

</head>

<body onload="selectVersion('Branch Build');">
  
<nav id="main">
  <div class="container">
    <div class="row">
      <div class="navbar navbar-default navbar-openshift" role="navigation">
        <div class="navbar-header">
            <a href="#nav-main" class="dropdown-toggle navbar-menu-toggle hidden visible-xs" data-toggle="collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>
          <a class="navbar-brand" href="/"></a>
        </div>
        <div id="nav-main" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li id="products" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
                Products <span class="fa fa-angle-down"></span>
              </a>
              <div class="dropdown-menu">
                <div class="row flex-column flex-md-row">
                  <div class="col-xs-12 col-sm-3">
                    <h3>Overview</h3>
                    <ul class="nav flex-column">
                      <li><a target="_blank" href="https://www.openshift.com/products/features/">Features</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/products/pricing/">Pricing</a></li>
                    </ul>
                  </div>
                  <div class="col-xs-12 col-sm-9">
                    <h3>Featured Products</h3>
                    <ul class="nav">
                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/container-platform/">Red Hat OpenShift Container&nbsp;Platform</a>
                        <p class="d-none d-md-block">Build, deploy and manage your applications across cloud- and on-premise infrastructure</p>
                      </li>
                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/dedicated/">Red Hat OpenShift Dedicated</a>
                        <p class="d-none d-md-block">Single-tenant, high-availability Kubernetes clusters in the public cloud</p>
                      </li>

                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/online/">Red Hat OpenShift Online</a>
                        <p class="d-none d-md-block">The fastest way for developers to build, host and scale applications in the public cloud</p>
                      </li>

                      <li class="nav-item">
                        <a target="_blank" href="https://www.openshift.com/products/">All products <span class="fa fa-angle-right"></span></a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>

            <li id="learn" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Learn <span class="fa fa-angle-down"></span>
              </a>
              <div class="dropdown-menu">
                <div class="row flex-md-nowrap">
                  <div class="col-xs-12 col-sm-6">
                    <h3>Learn</h3>
                    <ul class="nav">
                      <li><a target="_blank" href="https://www.openshift.com/learn/what-is-openshift/">What is OpenShift</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/get-started/">Get started</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/partners/">Partners</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/success-stories/">Customer success stories</a></li>
                      <li><a target="_blank" href="https://blog.openshift.com">Blog</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/resources/">Resources</a></li>
                    </ul>
                  </div>
                  <div class="col-xs-12 col-sm-6">
                    <h3>Technology Topics</h3>
                    <ul class="nav">
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/knative/">Knative</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/security/">Security</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/kubernetes/">Kubernetes</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/service-brokers/">Service Brokers</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Community <span class="fa fa-angle-down"></span>
              </a>
              <ul class="dropdown-menu">
                <li><a target="_blank" href="https://commons.openshift.org">OpenShift Commons</a></li>
                <li><a target="_blank" href="https://www.okd.io">Open Source (OKD)</a></li>
                <li><a target="_blank" href="https://www.openshift.com/community/programs/startups/">Startups</a></li>
                <li><a target="_blank" href="https://www.openshift.com/community/programs/grants/">Grants</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Support <span class="fa fa-angle-down"></span>
              </a>
              <ul class="dropdown-menu">
                <li><a target="_blank" href="https://help.openshift.com">Help Center</a></li>
                <li><a href="https://docs.openshift.com">OpenShift Docs</a></li>
              </ul>
            </li>

            <li><a target="_blank" class="nav-sign-up" href="https://www.openshift.com/trial/">Free Trial</a></li>

            <li><a target="_blank" href="https://console.redhat.com/openshift" class="nav-sign-in">Log In <span class="fa fa-angle-right"></span></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</nav>

  
  <div class="container">
    <button id="hc-open-btn" class="open-btn-sm" onclick="openNav()" aria-label="Open"><span class="fa fa-bars" /></button>
    <ol class="breadcrumb hide-for-print">
      

      

      

      

      

      

      <li class="sitename">
        <a href="/">
          Documentation</a>
      </li>
      <li class="hidden-xs active">
        
          <a href="../about/op-release-notes.html">Red Hat OpenShift Pipelines Branch Build</a>
        
      </li>
      <li class="hidden-xs active">
        <a href="../pac/about-pipelines-as-code.html">Pipelines as Code</a>
      </li>
      
      
      <li class="hidden-xs active">
        Managing pipeline runs
      </li>
      
      <span text-align="right" style="float: right !important">
        <a href="https://github.com/openshift/openshift-docs/commits/main/pac/managing-pipeline-runs-pac.adoc"><span class="material-icons-outlined" title="Page history">history</span></a>
        
        <a href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12332330&issuetype=1&components=12367614&priority=4&summary=Issue+in+file+pac/managing-pipeline-runs-pac.adoc">
          <span class="material-icons-outlined" title="Open an issue">bug_report</span>
        </a>
        <a href="javascript: void(0);" onclick="window.print()"><span class="material-icons-outlined" title="Print page (Save as PDF)">picture_as_pdf</span></a>
        
        
      </span>
      
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas hide-for-print">
        <div class="row-fluid">
          <div id="btn-close">
            <button id="hc-close-btn" onclick="closeNav()" class="close-btn-sm" aria-label="close"><span class="fa fa-times" /></button>
          </div>
          <div id="hc-search">
            <input id="hc-search-input" type="text" aria-label="search">
            <button id="hc-search-btn" aria-label="search"><span class="fa fa-search" /></button>
          </div>
        </div>
        <ul class="nav nav-sidebar">
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup0"><span id="tgSpan0" class="fa fa-angle-right"></span>About OpenShift Pipelines</a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../about/op-release-notes.html">OpenShift Pipelines release notes</a></li>
            <li><a class="" href="../about/about-pipelines.html">About OpenShift Pipelines</a></li>
            <li><a class="" href="../about/understanding-openshift-pipelines.html">Understanding OpenShift Pipelines</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup1"><span id="tgSpan1" class="fa fa-angle-right"></span>Installing and configuring</a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../install_config/installing-pipelines.html">Installing OpenShift Pipelines</a></li>
            <li><a class="" href="../install_config/uninstalling-pipelines.html">Uninstalling OpenShift Pipelines</a></li>
            <li><a class="" href="../install_config/customizing-configurations-in-the-tektonconfig-cr.html">Customizing configurations in the TektonConfig custom resource</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup2"><span id="tgSpan2" class="fa fa-angle-right"></span>Managing resource use</a>
      <ul id="topicGroup2" class="collapse  list-unstyled">
            <li><a class="" href="../resource/reducing-pipelines-resource-consumption.html">Reducing resource consumption of OpenShift Pipelines</a></li>
            <li><a class="" href="../resource/setting-compute-resource-quota-for-openshift-pipelines.html">Setting compute resource quota for OpenShift Pipelines</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup3"><span id="tgSpan3" class="fa fa-angle-right"></span>Creating CI/CD pipelines</a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../create/creating-applications-with-cicd-pipelines.html">Creating CI/CD solutions for applications using OpenShift Pipelines</a></li>
            <li><a class="" href="../create/working-with-pipelines-web-console.html">Working with OpenShift Pipelines in the web console</a></li>
            <li><a class="" href="../create/remote-pipelines-tasks-resolvers.html">Specifying remote pipelines and tasks using resolvers</a></li>
            <li><a class="" href="../create/managing-nonversioned-and-versioned-cluster-tasks.html">Managing non-versioned and versioned cluster tasks</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup4"><span id="tgSpan4" class="fa fa-angle-right"></span>Observability in OpenShift Pipelines</a>
      <ul id="topicGroup4" class="collapse  list-unstyled">
            <li><a class="" href="../records/using-tekton-results-for-openshift-pipelines-observability.html">Using Tekton Results for OpenShift Pipelines observability</a></li>
            <li><a class="" href="../records/viewing-pipeline-logs-using-the-openshift-logging-operator.html">Viewing pipeline logs using the OpenShift Logging Operator</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup5"><span id="tgSpan5" class="fa fa-angle-down"></span>Pipelines as Code</a>
      <ul id="topicGroup5" class="collapse in list-unstyled">
            <li><a class="" href="../pac/about-pipelines-as-code.html">About Pipelines as Code</a></li>
            <li><a class="" href="../pac/install-config-pipelines-as-code.html">Installing and configuring Pipelines as Code</a></li>
            <li><a class="" href="../pac/using-pipelines-as-code-repos.html">Using Pipelines as Code with a Git repository hosting service provider</a></li>
            <li><a class="" href="../pac/using-repository-crd.html">Using the Repository custom resource</a></li>
            <li><a class="" href="../pac/using-pac-resolver.html">Using the Pipelines as Code resolver</a></li>
            <li><a class=" active" href="../pac/managing-pipeline-runs-pac.html">Managing pipeline runs</a></li>
            <li><a class="" href="../pac/pac-command-reference.html">Pipelines as Code command reference</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup6"><span id="tgSpan6" class="fa fa-angle-right"></span>Securing OpenShift Pipelines</a>
      <ul id="topicGroup6" class="collapse  list-unstyled">
            <li><a class="" href="../secure/using-tekton-chains-for-openshift-pipelines-supply-chain-security.html">Using Tekton Chains for OpenShift Pipelines supply chain security</a></li>
            <li><a class="" href="../secure/configuring-security-context-for-pods.html">Configuring the security context for pods</a></li>
            <li><a class="" href="../secure/securing-webhooks-with-event-listeners.html">Securing webhooks with event listeners</a></li>
            <li><a class="" href="../secure/authenticating-pipelines-using-git-secret.html">Authenticating pipelines using git secret</a></li>
            <li><a class="" href="../secure/unprivileged-building-of-container-images-using-buildah.html">Unprivileged building of container images using Buildah</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup7"><span id="tgSpan7" class="fa fa-angle-right"></span>Custom Tekton Hub instance</a>
      <ul id="topicGroup7" class="collapse  list-unstyled">
            <li><a class="" href="../hub/using-tekton-hub-with-openshift-pipelines.html">Using Tekton Hub with OpenShift Pipelines</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup8"><span id="tgSpan8" class="fa fa-angle-right"></span>Pipelines CLI (tkn) reference</a>
      <ul id="topicGroup8" class="collapse  list-unstyled">
            <li><a class="" href="../tkn_cli/installing-tkn.html">Installing tkn</a></li>
            <li><a class="" href="../tkn_cli/op-configuring-tkn.html">Configuring tkn</a></li>
            <li><a class="" href="../tkn_cli/op-tkn-reference.html">Basic tkn commands</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div id="hc-search-modal">
        <div id="hc-modal-content">
          <span id="hc-modal-close">&times;</span>
          <div id="hc-search-results-wrapper">
            <div id="hc-search-results"></div>
            <div id="hc-search-progress-indicator" class="text-center search-progress-indicator"><i class="fa fa-circle-o-notch fa-spin" style="font-size:42px"></i></div>
            <div class="text-center">
              <button id="hc-search-more-btn">Show more results</button>
            </div>
          </div>
        </div>
      </div>
      <div class="print-logo" style="display:none;">
        <img src="https://www.redhat.com/cms/managed-files/Logo-Red_Hat-OpenShift-A-Standard-RGB_0_0.svg" alt="print logo"/>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h1>
            Managing pipeline runs
          </h1>
        </div>
        
        
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#creating-pipeline-run-using-pipelines-as-code_managing-pipeline-runs-pac">Creating a pipeline run using Pipelines as Code</a></li>
<li><a href="#running-pipeline-run-using-pipelines-as-code_managing-pipeline-runs-pac">Running a pipeline run using Pipelines as Code</a></li>
<li><a href="#restarting-or-canceling-pipeline-run-using-pipelines-as-code_managing-pipeline-runs-pac">Restarting or canceling a pipeline run using Pipelines as Code</a></li>
<li><a href="#monitoring-pipeline-run-status-using-pipelines-as-code_managing-pipeline-runs-pac">Monitoring pipeline run status using Pipelines as Code</a></li>
<li><a href="#cleaning-up-pipeline-run-using-pipelines-as-code_managing-pipeline-runs-pac">Cleaning up pipeline run using Pipelines as Code</a></li>
<li><a href="#using-incoming-webhook-with-pipelines-as-code_managing-pipeline-runs-pac">Using incoming webhook with Pipelines as Code</a></li>
<li><a href="#additional-resources-pac_managing">Additional resources</a></li>
</ul>
</div>
<div class="paragraph _abstract">
<p>Using Pipelines as Code, you can create pipelines in your code repository and run these pipelines.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-pipeline-run-using-pipelines-as-code_managing-pipeline-runs-pac"><a class="anchor" href="#creating-pipeline-run-using-pipelines-as-code_managing-pipeline-runs-pac"></a>Creating a pipeline run using Pipelines as Code</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>To run pipelines using Pipelines as Code, you can create pipelines definitions or templates as YAML files in the <code>.tekton/</code> directory of the repository. You can reference YAML files in other repositories using remote URLs, but pipeline runs are only triggered by events in the repository containing the <code>.tekton/</code> directory.</p>
</div>
<div class="paragraph">
<p>The Pipelines as Code resolver bundles the pipeline runs with all tasks as a single pipeline run without external dependencies.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>For pipelines, use at least one pipeline run with a spec, or a separated <code>Pipeline</code> object.</p>
</li>
<li>
<p>For tasks, embed task spec inside a pipeline, or define it separately as a Task object.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Parameterizing commits and URLs</div>
<p>You can specify the parameters of your commit and URL by using dynamic, expandable variables with the {{&lt;var&gt;}} format. Currently, you can use the following variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>{{repo_owner}}</code>: The repository owner.</p>
</li>
<li>
<p><code>{{repo_name}}</code>: The repository name.</p>
</li>
<li>
<p><code>{{repo_url}}</code>: The repository full URL.</p>
</li>
<li>
<p><code>{{revision}}</code>: Full SHA revision of a commit.</p>
</li>
<li>
<p><code>{{sender}}</code>: The username or account id of the sender of the commit.</p>
</li>
<li>
<p><code>{{source_branch}}</code>: The branch name where the event originated.</p>
</li>
<li>
<p><code>{{target_branch}}</code>: The branch name that the event targets. For push events, it&#8217;s the same as the <code>source_branch</code>.</p>
</li>
<li>
<p><code>{{pull_request_number}}</code>: The pull or merge request number, defined only for a <code>pull_request</code> event type.</p>
</li>
<li>
<p><code>{{git_auth_secret}}</code>: The secret name that is generated automatically with Git provider&#8217;s token for checking out private repos.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Matching an event to a pipeline run</div>
<p>You can match different Git provider events with each pipeline by using special annotations on the pipeline run. If there are multiple pipeline runs matching an event, Pipelines as Code runs them in parallel and posts the results to the Git provider as soon a pipeline run finishes.</p>
</div>
<div class="paragraph">
<div class="title">Matching a pull event to a pipeline run</div>
<p>You can use the following example to match the <code>pipeline-pr-main</code> pipeline with a <code>pull_request</code> event that targets the <code>main</code> branch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="nn">...</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">pipeline-pr-main</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="s">pipelinesascode.tekton.dev/on-target-branch</span><span class="pi">:</span> <span class="s2">"</span><span class="s">[main]"</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="s">pipelinesascode.tekton.dev/on-event</span><span class="pi">:</span> <span class="s2">"</span><span class="s">[pull_request]"</span>
<span class="nn">...</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can specify multiple branches by adding comma-separated entries. For example, <code>"[main, release-nightly]"</code>. In addition, you can specify the following:
<div class="ulist">
<ul>
<li>
<p>Full references to branches such as <code>"refs/heads/main"</code></p>
</li>
<li>
<p>Globs with pattern matching such as <code>"refs/heads/\*"</code></p>
</li>
<li>
<p>Tags such as <code>"refs/tags/1.\*"</code></p>
</li>
</ul>
</div></td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Matching a push event to a pipeline run</div>
<p>You can use the following example to match the <code>pipeline-push-on-main</code> pipeline with a <code>push</code> event targeting the <code>refs/heads/main</code> branch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="nn">...</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">pipeline-push-on-main</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="s">pipelinesascode.tekton.dev/on-target-branch</span><span class="pi">:</span> <span class="s2">"</span><span class="s">[refs/heads/main]"</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="s">pipelinesascode.tekton.dev/on-event</span><span class="pi">:</span> <span class="s2">"</span><span class="s">[push]"</span>
<span class="nn">...</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can specifiy multiple branches by adding comma-separated entries. For example, <code>"[main, release-nightly]"</code>. In addition, you can specify the following:
<div class="ulist">
<ul>
<li>
<p>Full references to branches such as <code>"refs/heads/main"</code></p>
</li>
<li>
<p>Globs with pattern matching such as <code>"refs/heads/\*"</code></p>
</li>
<li>
<p>Tags such as <code>"refs/tags/1.\*"</code></p>
</li>
</ul>
</div></td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Advanced event matching</div>
<p>Pipelines as Code supports using Common Expression Language (CEL) based filtering for advanced event matching. If you have the <code>pipelinesascode.tekton.dev/on-cel-expression</code> annotation in your pipeline run, Pipelines as Code uses the CEL expression and skips the <code>on-target-branch</code> annotation. Compared to the simple <code>on-target-branch</code> annotation matching, the CEL expressions allow complex filtering and negation.</p>
</div>
<div class="paragraph">
<p>To use CEL-based filtering with Pipelines as Code, consider the following examples of annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To match a <code>pull_request</code> event targeting the <code>main</code> branch and coming from the <code>wip</code> branch:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="nn">...</span>
  <span class="s">pipelinesascode.tekton.dev/on-cel-expression</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">event == "pull_request" &amp;&amp; target_branch == "main" &amp;&amp; source_branch == "wip"</span>
<span class="s">...</span></code></pre>
</div>
</div>
</li>
<li>
<p>To run a pipeline only if a path has changed, you can use the <code>.pathChanged</code> suffix function with a glob pattern:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="nn">...</span>
  <span class="s">pipelinesascode.tekton.dev/on-cel-expression</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">event == "pull_request" &amp;&amp; "docs/\*.md".pathChanged() </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="s">...</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Matches all markdown files in the <code>docs</code> directory.</td>
</tr>
</table>
</div>
</li>
<li>
<p>To match all pull requests starting with the title <code>[DOWNSTREAM]</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="nn">...</span>
  <span class="s">pipelinesascode.tekton.dev/on-cel-expression</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">event == "pull_request &amp;&amp; event_title.startsWith("[DOWNSTREAM]")</span>
<span class="s">...</span></code></pre>
</div>
</div>
</li>
<li>
<p>To run a pipeline on a <code>pull_request</code> event, but skip the <code>experimental</code> branch:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="nn">...</span>
  <span class="s">pipelinesascode.tekton.dev/on-cel-expression</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">event == "pull_request" &amp;&amp; target_branch != experimental"</span>
<span class="s">...</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For advanced CEL-based filtering while using Pipelines as Code, you can use the following fields and suffix functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>event</code>: A <code>push</code> or <code>pull_request</code> event.</p>
</li>
<li>
<p><code>target_branch</code>: The target branch.</p>
</li>
<li>
<p><code>source_branch</code>: The branch of origin of a <code>pull_request</code> event. For <code>push</code> events, it is same as the <code>target_branch</code>.</p>
</li>
<li>
<p><code>event_title</code>: Matches the title of the event, such as the commit title for a <code>push</code> event, and the title of a pull or merge request for a <code>pull_request</code> event. Currently, only GitHub, Gitlab, and Bitbucket Cloud are the supported providers.</p>
</li>
<li>
<p><code>.pathChanged</code>: A suffix function to a string. The string can be a glob of a path to check if the path has changed. Currently, only GitHub and Gitlab are supported as providers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, you can access the full payload as passed by the Git repository provider. Use the <code>headers</code> field to access the headers of the payload, for example, <code>headers['x-github-event']</code>. Use the <code>body</code> field to access the body of the payload, for example, <code>body.pull_request.state</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>using the header and body of the payload for CEL-based filtering with Pipelines as Code is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.</p>
</div>
<div class="paragraph">
<p>For more information about the support scope of Red Hat Technology Preview features, see <a href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following example, the pipeline run starts only if all of the following conditions are true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The pull request is targeting the <code>main</code> branch.</p>
</li>
<li>
<p>The author of the pull request is <code>superuser</code>.</p>
</li>
<li>
<p>The action is <code>synchronize</code>; this action triggers when an update occurs on a pull request.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">tekton.dev/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PipelineRun</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="s">pipelinesascode.tekton.dev/on-cel-expression</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">body.pull_request.base.ref == "main" &amp;&amp;</span>
        <span class="s">body.pull_request.user.login == "superuser" &amp;&amp;</span>
        <span class="s">body.action == "synchronize"</span>
<span class="c1"># ...</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use the <code>header</code> or <code>body</code> field for event matching, you might be unable to trigger the pipeline run using Git commands such as <code>retest</code>. If you use a Git command, the payload body is the comment that contains this command and not the original payload.</p>
</div>
<div class="paragraph">
<p>If you want to trigger the pipeline run again when using the <code>body</code> field for event matching, you can close and reopen the pull request or merge request, or alternatively add a new SHA commit, for example using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">git commit --amend --no-edit &amp;&amp; git push --force-with-lease</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Using the temporary GitHub App token for Github API operations</div>
<p>You can use the temporary installation token generated by Pipelines as Code from GitHub App to access the GitHub API. The token value is stored in the temporary <code>{{git_auth_secret}}</code> dynamic variable generated for private repositories in the <code>git-provider-token</code> key.</p>
</div>
<div class="paragraph">
<p>For example, to add a comment to a pull request, you can use the <code>github-add-comment</code> task from Tekton Hub using a Pipelines as Code annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="nn">...</span>
  <span class="s">pipelinesascode.tekton.dev/task</span><span class="pi">:</span> <span class="s2">"</span><span class="s">github-add-comment"</span>
<span class="nn">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then add a task to the <code>tasks</code> section or <code>finally</code> tasks in the pipeline run definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="pi">[</span><span class="nv">...</span><span class="pi">]</span>
<span class="na">tasks</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span>
      <span class="na">taskRef</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">github-add-comment</span>
      <span class="na">params</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">REQUEST_URL</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">repo_url</span><span class="nv"> </span><span class="s">}}/pull/{{</span><span class="nv"> </span><span class="s">pull_request_number</span><span class="nv"> </span><span class="s">}}"</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">COMMENT_OR_FILE</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Pipelines</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">Code</span><span class="nv"> </span><span class="s">IS</span><span class="nv"> </span><span class="s">GREAT!"</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">GITHUB_TOKEN_SECRET_NAME</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">git_auth_secret</span><span class="nv"> </span><span class="s">}}"</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">GITHUB_TOKEN_SECRET_KEY</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">git-provider-token"</span>
<span class="nn">...</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>By using the dynamic variables, you can reuse this snippet template for any pull request from any repository.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On GitHub Apps, the generated installation token is available for 8 hours and scoped to the repository from where the events originate unless configured differently on the cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://github.com/google/cel-spec/blob/master/doc/langdef.md">CEL language specification</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-pipeline-run-using-pipelines-as-code_managing-pipeline-runs-pac"><a class="anchor" href="#running-pipeline-run-using-pipelines-as-code_managing-pipeline-runs-pac"></a>Running a pipeline run using Pipelines as Code</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>With default configuration, Pipelines as Code runs any pipeline run in the <code>.tekton/</code> directory of the default branch of repository, when specified events such as pull request or push occurs on the repository. For example, if a pipeline run on the default branch has the annotation <code>pipelinesascode.tekton.dev/on-event: "[pull_request]"</code>, it will run whenever a pull request event occurs.</p>
</div>
<div class="paragraph">
<p>In the event of a pull request or a merge request, Pipelines as Code also runs pipelines from branches other than the default branch, if the following conditions are met by the author of the pull request:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The author is the owner of the repository.</p>
</li>
<li>
<p>The author is a collaborator on the repository.</p>
</li>
<li>
<p>The author is a public member on the organization of the repository.</p>
</li>
<li>
<p>The pull request author is listed in an <code>OWNER</code> file located in the repository root of the <code>main</code> branch as defined in the GitHub configuration for the repository. Also, the  pull request author is added to either <code>approvers</code> or <code>reviewers</code> section. For example, if an author is listed in the <code>approvers</code> section, then a pull request raised by that author starts the pipeline run.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="nn">...</span>
  <span class="na">approvers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">approved</span>
<span class="nn">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the pull request author does not meet the requirements, another user who meets the requirements can comment <code>/ok-to-test</code> on the pull request, and start the pipeline run.</p>
</div>
<div class="paragraph">
<div class="title">Pipeline run execution</div>
<p>A pipeline run always runs in the namespace of the <code>Repository</code> custom resource definition (CRD) associated with the repository that generated the event.</p>
</div>
<div class="paragraph">
<p>You can observe the execution of your pipeline runs using the <code>tkn pac</code> CLI tool.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To follow the execution of the last pipeline run, use the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>tkn pac logs <span class="nt">-n</span> &lt;my-pipeline-ci&gt; <span class="nt">-L</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>my-pipeline-ci</code> is the namespace for the <code>Repository</code> CRD.</td>
</tr>
</table>
</div>
</li>
<li>
<p>To follow the execution of any pipeline run interactively, use the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>tkn pac logs <span class="nt">-n</span> &lt;my-pipeline-ci&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>my-pipeline-ci</code> is the namespace for the <code>Repository</code> CRD.
If you need to view a pipeline run other than the last one, you can use the <code>tkn pac logs</code> command to select a <code>PipelineRun</code> attached to the repository:</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you have configured Pipelines as Code with a GitHub App, Pipelines as Code posts a URL in the <strong>Checks</strong> tab of the GitHub App. You can click the URL and follow the pipeline execution.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="restarting-or-canceling-pipeline-run-using-pipelines-as-code_managing-pipeline-runs-pac"><a class="anchor" href="#restarting-or-canceling-pipeline-run-using-pipelines-as-code_managing-pipeline-runs-pac"></a>Restarting or canceling a pipeline run using Pipelines as Code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can restart or cancel a pipeline run with no events, such as sending a new commit to your branch or raising a pull request. To restart all pipeline runs, use the <strong>Re-run all checks</strong> feature in the GitHub App.</p>
</div>
<div class="paragraph">
<p>To restart all or specific pipeline runs, use the following comments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>/test</code> and <code>/retest</code> comment restarts all pipeline runs.</p>
</li>
<li>
<p>The <code>/test &lt;pipeline_run_name&gt;</code> and <code>/retest &lt;pipeline_run_name&gt;</code> comment restarts a specific pipeline run.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To cancel all or specific pipeline runs, use the following comments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>/cancel</code> comment cancels all pipeline runs.</p>
</li>
<li>
<p>The <code>/cancel &lt;pipeline_run_name&gt;</code> comment cancels a specific pipeline run.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The results of the comments are visible under the <strong>Checks</strong> tab of the GitHub App.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>If you target a pull request and you use the GitHub App, go to the <strong>Checks</strong> tab and click <strong>Re-run all checks</strong>.</p>
</li>
<li>
<p>If you target a pull or merge request, use the comments inside your pull request:</p>
<div class="listingblock">
<div class="title">Example comment that cancels all pipeline runs</div>
<div class="content">
<pre class="rouge highlight nowrap"><code>This is a comment inside a pull request.
/cancel</code></pre>
</div>
</div>
</li>
<li>
<p>If you target a push request, include the comments within your commit messages.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is supported for the GitHub provider only.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Go to your GitHub repository.</p>
</li>
<li>
<p>Click the <strong>Commits</strong> section.</p>
</li>
<li>
<p>Click the commit where you want to restart a pipeline run.</p>
</li>
<li>
<p>Click on the line number where you want to add a comment.</p>
<div class="listingblock">
<div class="title">Example comment that retests a specific pipeline run</div>
<div class="content">
<pre class="rouge highlight nowrap"><code>This is a comment inside a commit.
/retest &lt;pipeline_run_name&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you run a command on a commit that exists in multiple branches within a push request, the branch with the latest commit is used.</p>
</div>
<div class="paragraph">
<p>This results in two situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you run a command on a commit without any argument, such as <code>/test</code>, the test is automatically performed on the <code>main</code> branch.</p>
</li>
<li>
<p>If you include a branch specification, such as <code>/test branch:user-branch</code>, the test is performed on the commit where the comment is located with the context of the <code>user-branch</code> branch.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="monitoring-pipeline-run-status-using-pipelines-as-code_managing-pipeline-runs-pac"><a class="anchor" href="#monitoring-pipeline-run-status-using-pipelines-as-code_managing-pipeline-runs-pac"></a>Monitoring pipeline run status using Pipelines as Code</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Depending on the context and supported tools, you can monitor the status of a pipeline run in different ways.</p>
</div>
<div class="paragraph">
<div class="title">Status on GitHub Apps</div>
<p>When a pipeline run finishes, the status is added in the <strong>Check</strong> tabs with limited information on how long each task of your pipeline took, and the output of the <code>tkn pipelinerun describe</code> command.</p>
</div>
<div class="paragraph">
<div class="title">Log error snippet</div>
<p>When Pipelines as Code detects an error in one of the tasks of a pipeline, a small snippet consisting of the last 3 lines in the task breakdown of the first failed task is displayed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Pipelines as Code avoids leaking secrets by looking into the pipeline run and replacing secret values with hidden characters. However, Pipelines as Code cannot hide secrets coming from workspaces and envFrom source.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Annotations for log error snippets</div>
<p>In the <code>TektonConfig</code> custom resource, in the <code>pipelinesAsCode.settings</code> spec, you can set the <code>error-detection-from-container-logs</code> parameter to <code>true</code>. In this case, Pipelines as Code detects the errors from the container logs and adds them as annotations on the pull request where the error occurred.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Adding annotations for log error snippets is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.</p>
</div>
<div class="paragraph">
<p>For more information about the support scope of Red Hat Technology Preview features, see <a href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Currently, Pipelines as Code supports only the simple cases where the error looks like <code>makefile</code> or <code>grep</code> output of the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="s">&lt;filename&gt;:&lt;line&gt;:&lt;column&gt;: &lt;error message&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can customize the regular expression used to detect the errors with the <code>error-detection-simple-regexp</code> parameter. The regular expression uses named groups to give flexibility on how to specify the matching. The groups needed to match are <code>filename</code>, <code>line</code>, and <code>error</code>. You can view the Pipelines as Code config map for the default regular expression.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, Pipelines as Code scans only the last 50 lines of the container logs. You can increase this value in the <code>error-detection-max-number-of-lines</code> field or set <code>-1</code> for an unlimited number of lines. However, such configurations may increase the memory usage of the watcher.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Status for webhook</div>
<p>For webhook, when the event is a pull request, the status is added as a comment on the pull or merge request.</p>
</div>
<div class="paragraph">
<div class="title">Failures</div>
<p>If a namespace is matched to a <code>Repository</code> custom resource definition (CRD), Pipelines as Code emits its failure log messages in the Kubernetes events inside the namespace.</p>
</div>
<div class="paragraph">
<div class="title">Status associated with Repository CRD</div>
<p>The last 5 status messages for a pipeline run is stored inside the <code>Repository</code> custom resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get repo <span class="nt">-n</span> &lt;pipelines-as-code-ci&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">NAME                  URL                                                        NAMESPACE             SUCCEEDED   REASON      STARTTIME   COMPLETIONTIME
pipelines-as-code-ci   https://github.com/openshift-pipelines/pipelines-as-code   pipelines-as-code-ci   True        Succeeded   59m         56m</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>tkn pac describe</code> command, you can extract the status of the runs associated with your repository and its metadata.</p>
</div>
<div class="paragraph">
<div class="title">Notifications</div>
<p>Pipelines as Code does not manage notifications. If you need to have notifications, use the <code>finally</code> feature of pipelines.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://github.com/chmouel/tekton-slack-task-status">An example task to send Slack messages on success or failure</a></p>
</li>
<li>
<p><a href="https://github.com/openshift-pipelines/pipelines-as-code/blob/7b41cc3f769af40a84b7ead41c6f037637e95070/.tekton/push.yaml">An example of a pipeline run with <code>finally</code> tasks triggered on push events</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://github.com/openshift-pipelines/pipelines-as-code/blob/main/test/testdata/pipelinerun_git_clone_private.yaml">An example of the <code>git-clone</code> task used for cloning private repositories</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cleaning-up-pipeline-run-using-pipelines-as-code_managing-pipeline-runs-pac"><a class="anchor" href="#cleaning-up-pipeline-run-using-pipelines-as-code_managing-pipeline-runs-pac"></a>Cleaning up pipeline run using Pipelines as Code</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>There can be many pipeline runs in a user namespace. By setting the <code>max-keep-runs</code> annotation, you can configure Pipelines as Code to retain a limited number of pipeline runs that matches an event. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="nn">...</span>
  <span class="s">pipelinesascode.tekton.dev/max-keep-runs</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;max_number&gt;"</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nn">...</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Pipelines as Code starts cleaning up right after it finishes a successful execution, retaining only the maximum number of pipeline runs configured using the annotation.
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Pipelines as Code skips cleaning the running pipelines but cleans up the pipeline runs with an unknown status.</p>
</li>
<li>
<p>Pipelines as Code skips cleaning a failed pull request.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-incoming-webhook-with-pipelines-as-code_managing-pipeline-runs-pac"><a class="anchor" href="#using-incoming-webhook-with-pipelines-as-code_managing-pipeline-runs-pac"></a>Using incoming webhook with Pipelines as Code</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Using an incoming webhook URL and a shared secret, you can start a pipeline run in a repository.</p>
</div>
<div class="paragraph">
<p>To use incoming webhooks, specify the following within the <code>spec</code> section of the <code>Repository</code> custom resource definition (CRD):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The incoming webhook URL that Pipelines as Code matches.</p>
</li>
<li>
<p>The Git provider and the user token. Currently, Pipelines as Code supports <code>github</code>, <code>gitlab</code>, and <code>bitbucket-cloud</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using incoming webhook URLs in the context of GitHub app, you must specify the token.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The target branches and a secret for the incoming webhook URL.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example: <code>Repository</code> CRD with incoming webhook</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s2">"</span><span class="s">pipelinesascode.tekton.dev/v1alpha1"</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Repository</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">repo</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ns</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">url</span><span class="pi">:</span> <span class="s2">"</span><span class="s">https://github.com/owner/repo"</span>
  <span class="na">git_provider</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">github</span>
    <span class="na">secret</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">owner-token"</span>
  <span class="na">incoming</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">main</span>
      <span class="na">secret</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">repo-incoming-secret</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">webhook-url</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: The <code>repo-incoming-secret</code> secret for incoming webhook</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">repo-incoming-secret</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ns</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">Opaque</span>
<span class="na">stringData</span><span class="pi">:</span>
  <span class="na">secret</span><span class="pi">:</span> <span class="s">&lt;very-secure-shared-secret&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To trigger a pipeline run located in the <code>.tekton</code> directory of a Git repository, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>curl <span class="nt">-X</span> POST <span class="s1">'https://control.pac.url/incoming?secret=very-secure-shared-secret&amp;repository=repo&amp;branch=main&amp;pipelinerun=target_pipelinerun'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pipelines as Code matches the incoming URL and treats it as a <code>push</code> event. However, Pipelines as Code does not report status of the pipeline runs triggered by this command.</p>
</div>
<div class="paragraph">
<p>To get a report or a notification, add it directly with a <code>finally</code> task to your pipeline. Alternatively, you can inspect the <code>Repository</code> CRD with the <code>tkn pac</code> CLI tool.</p>
</div>
</div>
</div>
<div class="sect1 _additional-resources">
<h2 id="additional-resources-pac_managing"><a class="anchor" href="#additional-resources-pac_managing"></a>Additional resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/openshift-pipelines/pipelines-as-code/tree/main/.tekton">An example of the <code>.tekton/</code> directory in the Pipelines as Code repository</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/applications/creating_applications/odc-creating-applications-using-developer-perspective.html">Creating applications using the Developer perspective</a></p>
</li>
</ul>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <script src="https://assets.openshift.net/content/modernizr.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/subdomain.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/nav-tertiary.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/reformat-html.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/hc-search.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/page-loader.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/clipboard.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/collapsible.js" type="text/javascript"></script>
  <script>
  var dk = 'openshift-pipelines';
  var version = 'Branch Build';

  var distros = {
    'openshift-origin': ['docs_origin', version],
    // specific labels are used for OSD instead of the URL filter, due to its unusual URL structure; assume v4
    'openshift-dedicated': ['docs_dedicated_v4'],
    'openshift-online': ['docs_online', version],
    'openshift-enterprise': ['docs_cp', version],
    'openshift-aro' : ['docs_aro', version],
    'openshift-rosa' : ['docs_rosa'],
    'openshift-acs' : ['docs_acs', version],
    'openshift-serverless' : ['docs_serverless', version]
  };

  // only OSD v3 docs have the version variable specified
  if (dk == "openshift-dedicated" && version == "3") {
    distros['openshift-dedicated'] = ['docs_dedicated_v3']
  }

  distros[dk] ? hcSearchCategory.apply(null, distros[dk]) : hcSearchCategory("docs");
  </script>
  <script type="text/javascript">
  /*<![CDATA[*/
  $(document).ready(function() {
    $("[id^='topicGroup']").on('show.bs.collapse', function(event) {
      if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
        $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
      }
    });
    $("[id^='topicGroup']").on('hide.bs.collapse', function(event) {
      if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
        $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
      }
    });
    $("[id^='topicSubGroup']").on('show.bs.collapse', function() {
      $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubGroup']").on('hide.bs.collapse', function() {
      $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubSubGroup']").on('show.bs.collapse', function() {
      $(this).parent().find("[id^='ssgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubSubGroup']").on('hide.bs.collapse', function() {
      $(this).parent().find("[id^='ssgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });

    const collapsibleContent = document.getElementsByTagName("details");
    for (var i = 0; i < collapsibleContent.length; i++) {
      collapsibleContent[i].setAttribute("open", "");
    }

  });
  /*]]>*/
  </script>

  <footer id="rh">

    <div class="container">
        <div class="row">

            <div class="col-sm-2">
                <img src="https://assets.openshift.com/hubfs/images/logos/Logo-RedHat-A-Reverse-RGB.svg" class="img-fluid" alt="Red Hat" style="height: 30px;">
            </div>

            <div class="col-sm-3">
              <p class="text-nowrap">Copyright  2023 Red Hat, Inc.</p>
            </div>



            <div class="col">
                <nav class="nav">
                    <a target="_blank" href="https://www.redhat.com/en/about/privacy-policy" class="nav-link">Privacy statement</a>
                    <a target="_blank" href="https://www.openshift.com/legal/terms/" class="nav-link">Terms of use</a>
                    <a target="_blank" href="https://www.redhat.com/en/about/all-policies-guidelines" class="nav-link">All policies and guidelines</a>
                    <a id="teconsent"></a>
                </nav>
            </div>
        </div>
    </div>
</footer>
<div id="consent_blackbar" style="z-index: 100; position: fixed"></div>



<!-- Adobe DTM -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
   _satellite.pageBottom();
}
</script>
<!-- End Adobe DTM -->

  <!-- adjust page css based on breadcrumb and/or resize -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      if ($(window).width() >= 1008) {
        adjustSide();
        adjustToc();
        adjustMain();
      }
    });

    window.addEventListener('resize', () => {
      if ($(window).width() >= 1008) {
        adjustSide();
        adjustToc();
        adjustMain();
      } else if ($(window).width() < 1008) {
        sidebar.classList.remove('wide');
        document.querySelector('#hc-search').classList.remove('wide');
        if (sidebar.classList.contains('open')) {
          sidebar.style.display = 'block';
        } else {
          sidebar.style.display = 'none';
        }
        document.querySelector('.main').style.paddingTop = '0px';
      }
    });

    function adjustSide() {
      sidebar.classList.add('wide');
      document.querySelector('#hc-search').classList.add('wide');
      sidebar.style.display = 'block';
      document.querySelector('.sidebar').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 125), 10) + "px";
      document.querySelector('#hc-search').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 95), 10) + "px";
    }

    function adjustToc() {
      if (document.querySelector('#toc') !== null) {
        document.querySelector('#toc').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 90), 10) + "px";
      }
    }

    function adjustMain() {
      document.querySelector('html').style.scrollPaddingTop = parseInt((document.querySelector('.breadcrumb').offsetHeight + 90), 10) + "px";
      document.querySelector('.main').style.paddingTop = parseInt((document.querySelector('.breadcrumb').offsetHeight - 70), 10) + "px";
    }

  </script>

  <!-- remove toc active class when page is loaded -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      var tocItems = $("#toc a");

      for (let i = 0; i < tocItems.length; i++) {
        tocItems[i].classList.remove("toc-active");
      }
    })
  </script>

  <!-- maintain sidebar scroll position between page loads -->
  <script type="text/javascript">
    let sidebar = document.querySelector(".sidebar");
    let scrolltop = localStorage.getItem("sidebar-scroll");

    if (scrolltop == null) {
      sidebar.scrollTop = parseInt(top, 10);
    }

    window.addEventListener("beforeunload", () => {
      localStorage.setItem("sidebar-scroll", sidebar.scrollTop);
    });

    window.addEventListener('load', () => {
      sidebar.scrollTo(0, scrolltop)
    })
  </script>

  <!-- open/close the nav -->
  <script type="text/javascript">
    function closeNav() {
      let sidebar = document.querySelector(".sidebar");
      sidebar.style.display = "none";
      sidebar.classList.remove('open');
    }

    function openNav() {
      let sidebar = document.querySelector(".sidebar");
      let hc_search = document.querySelector('#hc-search');
      sidebar.style.display = "block";
      sidebar.style.top = "0px";
      hc_search.style.top = 'unset';
      sidebar.classList.add('open');
    }
  </script>

  <!-- clear and add toc-active to clicked toc link -->
  <script type="text/javascript">
  $("#toc a").click(function() {
    var tocItems = $("#toc a");
    for (let i = 0; i < tocItems.length; i++) {
      tocItems[i].classList.remove("toc-active");
    }
    this.classList.add("toc-active");
  });
  </script>

  <!-- update active toc class when mouse scrolls -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      window.addEventListener("wheel", () => {

        const ioConfiguration = {
          "rootMargin": "-120px 0px -400px 0px",
          "threshold": 0
        };

        const observer = new IntersectionObserver(setCurrent, ioConfiguration, entries => {
          entries.forEach(entry => {
            var id = entry.target.getAttribute('id');
            //fight with js
            document.querySelector(`#toc li a[href="#${id}"]`).classList.remove('toc-active');
          });
        });

        //track all h1-4 headings that have an id
        document.querySelectorAll('.main h2[id], .main h3[id]').forEach((h) => {
          observer.observe(h);
        });

        //runs when the IntersectionObserver fires
        function setCurrent(e) {
          var allTocLinks = document.querySelectorAll("#toc li a");
          if (allTocLinks !== undefined) {
            e.map(i => {
              if (i.isIntersecting && i.intersectionRatio >= 1) {
                allTocLinks.forEach(link => link.classList.remove("toc-active"));
                document.querySelector(`#toc li a[href="#${i.target.id}"]`).classList.add('toc-active')
              }
            })
          }
        };

        //make clicked toc item active and stop IntersectionObserver
        $("#toc a").click(function() {
          //stop tracking all h1-4 headings that have an id
          document.querySelectorAll('.main h2[id], .main h3[id]').forEach((h) => {
            observer.unobserve(h);
          });
          var tocItems = $("#toc a");
          if (tocItems !== undefined) {
            for (let i = 0; i < tocItems.length; i++) {
              tocItems[i].classList.remove("toc-active");
            };
            this.classList.add("toc-active");
          }
        })
      })
    })
  </script>

  <!--handle page scroll top and bottom, add toc-active -->
  <script type="text/javascript">
    document.addEventListener('scroll', () => {
      //scroll to bottom
      if(document.documentElement.scrollHeight === window.pageYOffset + window.innerHeight) {
        var tocItems = $("#toc a");
        for (let i = 0; i < tocItems.length; i++) {
          tocItems[i].classList.remove("toc-active")
          };
          tocItems[tocItems.length - 1].classList.add("toc-active");
        };
      //scroll to top
      if(window.pageYOffset === 0) {
        var tocItems = $("#toc a");
        for (let i = 0; i < tocItems.length; i++) {
          tocItems[i].classList.remove("toc-active");
          };
          tocItems[0].classList.add("toc-active");
        };
      })
  </script>

  <!--adjust sidebar and toc when footer is displayed -->
  <script type="text/javascript">
    sidebar = document.querySelector('.sidebar')
    toc = document.querySelector('#toc')
    main = document.querySelector('.main')
    okd_footer = document.querySelector('.footer-origin-docs')

    //handle short pages
    if (window.innerHeight === document.documentElement.scrollHeight) {
      //sidebar
      if (sidebar !== null && okd_footer == null) {
        sidebar.style.marginBottom = "38px";
        main.style.marginBottom = "35px";
      };
      //okd sidebar
      if(sidebar !== null && okd_footer !== null) {
        sidebar.style.marginBottom = "176px";
        main.style.marginBottom = "135px";
      }
    };

    //handle scrolling pages
    document.addEventListener('scroll', () => {
      //scroll to bottom
      if ($(window).width() >= 1008) {
        if(sidebar !== null) {
          //pages with multiple toc entries
          if(document.documentElement.scrollHeight === window.pageYOffset + window.innerHeight) {
              //sidebar
              if (sidebar !== null && okd_footer == null){
                sidebar.style.marginBottom = "38px";
                main.style.marginBottom = "35px";
              };
              //toc
              if (toc !== null && okd_footer == null){
                toc.style.bottom = "35px";
              };
              //okd sidebar
              if(sidebar !== null && okd_footer !== null) {
                sidebar.style.marginBottom = "176px";
                main.style.marginBottom = "135px";
              };
              //okd toc
              if (toc !== null && okd_footer !== null){
                toc.style.bottom = "175px";
              };
            };
          if(document.documentElement.scrollHeight != window.pageYOffset + window.innerHeight) {
            sidebar.style.marginBottom = "0px";
            if (toc !== null) {
              toc.style.bottom = "0px";
            }
          }
        }
      }
    })
  </script>

  <!-- adjust alerts on mobile -->
  <script type="text/javascript">
    alert = document.querySelector('#support-alert')
    window.addEventListener("wheel", () => {
      if ($(window).width() < 1008) {
        //adjust alert
        if(window.pageYOffset > 0) {
          if(alert !== null) {
            document.querySelector('#support-alert').style.position = "fixed";
            document.querySelector('#support-alert').style.bottom = "0px";
            document.querySelector('#support-alert').style.margin = "5px";
            document.querySelector('#support-alert').style.zIndex = "9999999";
          }
        }
      }
   });
    window.addEventListener('resize', () => {
      if ($(window).width() >= 1008) {
        if(alert !== null) {
          document.querySelector('#support-alert').style.removeProperty('position');
          document.querySelector('#support-alert').style.removeProperty('bottom');
          document.querySelector('#support-alert').style.removeProperty('margin');
          document.querySelector('#support-alert').style.removeProperty('zIndex');
        }
      }
    })
  </script>

</body>
</html>